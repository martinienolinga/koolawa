Ext.onReady(function(){Ext.define("filesTreeModel",{extend:"Ext.data.Model",fields:[{name:"recid",type:"string"},{name:"idpath",type:"string"},{name:"text",type:"string"},{name:"path",type:"string"},{name:"shortpath",type:"string"}],proxy:{type:"memory"}})});workspace.storagepanel.getFileTreePanel=function(a){if(typeof a.isCom==="undefined"){a.isCom=false}var b=Ext.create("Ext.Panel",{region:"west",minWidth:200,width:300,autoScroll:true,items:[workspace.storagepanel.getFilesTree(a)]});if(a.isCom){b.collapsible=false}return b};workspace.storagepanel.getFilesTree=function(b){if(typeof b.isCom==="undefined"){b.isCom=false}var a=Ext.create("Ext.tree.Panel",{store:Ext.create("Ext.data.TreeStore",{model:"filesTreeModel"}),rootVisible:false,gotoNode:function(c){a.selectPath(c.shortpath,"text",null,function(){var f=a.getRootNode();var e=f.findChild("recid",c.recid,true);var d=a.getView();var g=d.getNode(e);g.scrollIntoView(a.view.el,false,true);a.fireEvent("itemclick",d,e)})},addChildren:function(c,d){$.each(d,function(e,f){var g=c.appendChild({recid:f.recid,text:f.text,path:f.path,shortpath:f.shortpath,idpath:f.idpath,leaf:f.leaf});if(!f.leaf){a.addChildren(g,f.children)}})},listeners:{afterrender:function(c,d){var e=new Ext.LoadMask({target:a.up("panel"),msg:"Veuillez patienter ..."});e.show();symfony("list","directories","storage",{},function(f){var g=a.getRootNode();a.addChildren(g,f.data);e.hide()})},itemclick:function(f,i,h,g,d){if(!i.get("leaf")){var c={};if(b.isCom){var c=workspace.storagepanel.storagePanel.filesPanel}else{var c=workspace.storagepanel.storagePanel.filesPanel.getActiveTab();if(c.kind!=="directory"){c=workspace.storagepanel.showDirectory("new file 1");workspace.storagepanel.storagePanel.filesPanel.setActiveTab(c)}}var e=new Ext.LoadMask({target:c.content,msg:"Chargement en cours ..."});e.show();symfony("list","files","storage",{path:i.data.path},function(k){var l=$(c.path.getEl().dom);l.empty();var j=i.data.idpath.split(">");$.each(j,function(r,p){if(p!=="root"){var o=a.getRootNode();var n=o.findChild("recid",p,true);var q=new Ext.Button({text:n.data.text,listeners:{click:function(){a.gotoNode(n.data)}},renderTo:l.get()[0]})}});var m=$(c.content.getEl().dom);m.empty();$.each(k.data,function(q,r){var s="icon-empty_48";if(!r.leaf){s="icon-folder_48"}var o=$("<div>",{"class":"thumb icon "+s});var p=$("<div>",{"class":"label",html:r.text});var n=$("<div>",{"class":"tabitem",title:r.text});n.rec=r;n.append(o);n.append(p);n.on("dblclick",function(t){if(!n.rec.leaf){a.gotoNode(n.rec)}else{if(typeof b.ondblclick!=="undefined"){b.ondblclick()}}});n.on("click",function(t){$(".tabitem").removeClass("tabitemselected");symfony("get","stat","storage",{path:n.rec.path},function(u){var x=$(c.status.getEl().dom);var v=parseInt(u.data.stat.size);var w="o";if(v>=1024){v=v/1024;w="Ko"}if(v>=1024){v=v/1024;w="Mo"}if(v>=1024){v=v/1024;w="Go"}if(v>=1024){v=v/1024;w="To"}v=Math.round(v);x.html("Taille: "+v+" "+w+" | "+n.rec.path);n.addClass("tabitemselected");if(!n.rec.leaf){}if(typeof b.onselect!=="undefined"){u.data.rec=n.rec;b.onselect(u.data)}})});m.append(n)});e.hide();$(document).tooltip()})}}}});return a};