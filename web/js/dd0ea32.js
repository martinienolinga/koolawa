var accordionPanel={};var propertyPanel={};var centerPanel={};var bottomPanel={};var currentWorkspace={name:""};var clipboard={kind:"empty"};function aboutTab(){var a="";a+='<div align="center">';a+="<div><br/></div>";a+='<div class="totem-logo"></div>';a+="<div><b>Totem</b></div>";a+="<div>0.0.1.34 alpha</div>";a+="<div><br/></div>";a+="<div>Totem est une application de génération de rapports basés sur les enregistrements d'une ou plusieurs bases de données</div>";a+="<div><br/></div>";a+='<div>Développé par : <a href="mailto:martinien.olingaayissi@t2safrica.com">Martinien OLINGA AYISSI</a></div>';a+="<div>Ingénieur Système Linux</div>";a+="<div>T2SA - DSR</div>";a+="<div><br/></div>";a+="<div><b>Technologies utilisées</b></div>";a+="<div><br/></div>";a+="<div>Ext.Js 4.2.1.883</div>";a+="<div>Extensible 1.5.2</div>";a+="<div>Codemirror 5.3.1</div>";a+="<div>jQuery 2.1.4</div>";a+="<div><br/></div>";a+="<div>Symfony 2.3.30</div>";a+="<div>Html2Pdf 4.03</div>";a+="<div>FR3D 2.0.0</div>";a+="</div>";return Ext.create("Ext.Panel",{title:"A propos de Totem",html:a})}var firstCenterDisplay=true;function replaceAll(d,a,c){var b=new RegExp(d,"g");c=c.replace(b,a);return c}function showobject(b){var c=$('<div style="padding:5px; overflow:scroll; position: absolute; display:block; width:700px; height:400px; background-color:white; border:5px solid black; z-index:100000; left:10px; top:10px">');c.append($("<div>").append($("<button>").html("close").on("click",function(){c.remove()})).append($("<hr>")));var a=$('<table width="100%" border="0" style="padding-bottom:30px;">');a.append($("<tr>").append($("<td>").html("<b>KEY</b>")).append($("<td>").html("<b>VALUE</b>")));$.each(b,function(e,g){var d=$('<td style="font-weight:bold;">').html(e);d.obj=g;d.on("click",function(h){showobject(d.obj)});var f=$("<td>").html(""+g);a.append($("<tr>").append(d).append(f))});c.append(a);$("body").append(c)}function customField(b,c,d,a){Ext.define(b,{extend:"Ext.form.field.Picker",alias:"widget."+c,editable:false,hideTrigger:true,pickerOffset:[0,-24],listeners:{focus:function(f,h,g){f.expand()}},cancelEdit:function(){var e=this;e.fireEvent("blur");e.collapse()},applyValues:function(){var f=this,e=f.picker,g=e.getForm().getValues();f.setValue(Ext.encode(g));f.fireEvent("blur");f.collapse()},createPicker:function(){var e=this,f=Ext.String.format;return Ext.create("Ext.form.Panel",{title:d,bodypadding:5,pickerField:e,ownerCt:e.ownerCt,renderTo:document.body,floating:true,bodyPadding:8,items:a,dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"button",name:"cancel",text:"Annuler",iconCls:"cancelicon",handler:function(g,i,h){e.cancelEdit()}},"->",{xtype:"button",name:"save",text:"OK",iconCls:"accepticon",handler:function(g,i,h){e.applyValues()}}]}],listeners:{afterrender:function(g,h){g.getForm().setValues(Ext.decode(e.getValue()))}}})}})}customField("DescriptionField","descriptionfield","Description",[{xtype:"textfield",fieldLabel:"Résumé",labelAlign:"top",anchor:"100%",name:"description_resume"},{xtype:"textareafield",fieldLabel:"Détails",labelAlign:"top",anchor:"100%",name:"description_details"}]);Ext.require(["*"]);Ext.onReady(function(){var a=new Ext.LoadMask(Ext.getBody(),{msg:"Veuillez patienter ..."});a.show();symfony("get","logged","user",{},function(d){workspaceUsers.logged=d.data;workspaceQueries.init();workspaceReports.init();workspacePlannings.init();workspaceUsers.init();workspaceDatasources.init();workspaceSettings.init();a.hide();propertyPanel=Ext.create("Ext.tab.Panel",{tabPosition:"bottom",region:"west",collapsible:true,split:true,width:330,minWidth:220,minHeight:140,title:"Etat",activeTab:0,layout:{type:"vbox",padding:5,align:"stretch"},items:[]});bottomPanel=Ext.create("Ext.tab.Panel",{id:"bottom-panel",title:"Splitter above me",resizeTabs:true,enableTabScroll:true,region:"south",height:300,split:true,collapsible:true,frame:true,minHeight:60,weight:-100,defaults:{autoScroll:true,bodyPadding:10},items:[]});accordionPanel=Ext.create("Ext.Panel",{id:"accordion",region:"west",split:true,width:250,layout:"accordion",items:[(workspaceUsers.logged.rules.queryDisplay)?workspaceQueries.itemQueries:null,(workspaceUsers.logged.rules.reportDisplay)?workspaceReports.itemReports:null,(workspaceUsers.logged.rules.planningDisplay)?workspacePlannings.itemPlannings:null,(workspaceUsers.logged.rules.userDisplay)?workspaceUsers.itemUsers:null,(workspaceUsers.logged.rules.datasourceDisplay)?workspaceDatasources.itemDatasources:null,(workspaceUsers.logged.rules.settingDisplay)?workspaceSettings.itemSettings:null],tbar:[{text:"Se déconnecter",iconCls:"icon-logout",key:"logout",handler:function(){symfony("logout","user","user",{},function(i){document.location="./logout"})}}]});var f=Ext.create("Ext.Panel",{title:"Accueil",iconCls:"icon-home",html:'<div id="welcomediv"></div>',closable:false});f.welcome=true;centerPanel=Ext.create("Ext.tab.Panel",{region:"center",id:"centerPanel",resizeTabs:true,enableTabScroll:true,minHeight:80,frame:true,defaults:{autoScroll:true,bodyPadding:10},items:[f],listeners:{tabchange:function(j,i){if(i.workspace!==undefined){currentWorkspace=i.workspace;currentWorkspace.set({tab:i},function(){currentWorkspace.onCenterTabChange(j,i)})}else{if(i.welcome!==undefined){h()}}}}});workspaceReports.set({tab:"welcome"},function(){h()});function h(){bottomPanel.hide();var j=centerPanel;if(firstCenterDisplay){j=Ext.getBody();firstCenterDisplay=false}propertyPanel.removeAll();var i=aboutTab();propertyPanel.add(i);propertyPanel.setActiveTab(i);var k=new Ext.LoadMask(j,{msg:"Chargement en cours ..."});k.show();symfony("get","files","report",{},function(l){var m="<div>";$.each(l.data,function(n,o){m+='<div class="totem-files"><a href="./file?'+o.Id+'">'+o.text+"</a></div>"});m+="</div>";$("#welcomediv").html(m);k.hide()})}var b;function g(l,k,m,i){var j=m.ownerCt;e.unshift(j.initialConfig);c.remove(j)}var e=[{region:"north",title:"North 2",height:100,collapsible:true,weight:-120},{region:"east",title:"East 2",width:100,collapsible:true,weight:-110},{region:"west",title:"West 2",width:100,collapsible:true,weight:-110}];var c=Ext.create("Ext.Viewport",{layout:{type:"border",padding:0},defaults:{split:true},items:[{region:"north",cls:"app-header",height:60,minHeight:60,maxHeight:60,html:'<div class="totem-logo-small"></div>Plateforme Totem'},accordionPanel,centerPanel,propertyPanel,bottomPanel]})})});
Ext.require(["*"]);Ext.onReady(function(){var a=[];for(i=1;i<=32;i++){a.push({value:"color"+i,text:"Couleur "+i,color:"x-cal-"+i+"-ad"})}var b=Ext.create("Ext.data.Store",{fields:["value","text","color"],data:a});Ext.define("Totem.ux.color.Combo",{extend:"Ext.form.field.ComboBox",alias:"widget.ux_colorcombo",colorField:"color",displayField:"text",valueField:"color",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">','<span class="{color} color-box-icon"></span>{text}',"</div>","</tpl>"),fieldSubTpl:['<div class="{hiddenDataCls}" role="presentation"></div>',"<div>",'<span id="{id}color" class="{[this.getColor(values)]} color-box-icon" style="float: left; position: absolute; margin: 0px 2px 2px 3px;"></span>','<input id="{id}" type="{type}" {inputAttrTpl} class="fieldCls" {typeCls} {editableCls} autocomplete="off"','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','style="border:none; display:none;"/>','<span id="{id}span" style="margin-left: 23px;">','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</span>","</div>",{compiled:true,disableFormats:true,getColor:function(c){var d=this;var e=b.findRecord("text",c.value);return e.get("color")}}],initComponent:function(){var c=this;c.store=b;this.callParent(arguments);c.on("change",function(d,f){var e=c.getStore().findRecord(c.valueField,c.value);$("#"+c.inputId+"color").attr("class",e.get(c.colorField)+" color-box-icon");$("#"+c.inputId+"span").html(e.get(c.displayField))})}});Ext.define("Totem.ux.view.GroupingList",{extend:"Ext.view.View",alias:"widget.groupinlist",requires:["Ext.layout.component.BoundList","Ext.toolbar.Paging"],pageSize:0,autoScroll:true,baseCls:Ext.baseCSSPrefix+"boundlist",listItemCls:"",shadow:false,trackOver:true,refreshed:0,ariaRole:"listbox",componentLayout:"boundlist",renderTpl:['<div class="list-ct"></div>'],initComponent:function(){var f=this;var e=f.baseCls;var g=e+"-item";f.itemCls=g;f.selectedItemCls=e+"-selected";f.overItemCls=e+"-item-over";f.itemSelector="."+g;if(f.floating){f.addCls(e+"-floating")}var c=['<ul class="ul-x-combobox">','<tpl for=".">'];var h=1;if(Ext.isArray(f.groupField)){h=f.groupField.length;for(var d=0;d<f.groupField.length;d++){c.push("<tpl if=\"xindex == 1 || parent[xindex - 2]['"+f.groupField[d]+"'] != values['"+f.groupField[d]+"']\">",'<li class="x-combo-list-group" style="padding-left:'+(d*16)+'px;">{[values["'+f.groupField[d]+'"]]}</li>',"</tpl>")}}else{c.push("<tpl if=\"xindex == 1 || parent[xindex - 2]['"+f.groupField+"'] != values['"+f.groupField+"']\">",'<li class="x-combo-list-group">{[values["'+f.groupField+'"]]}</li>',"</tpl>")}c.push('<li role="option" class="'+g+'" style="padding-left:'+(h*16)+'px;">{[values["'+f.displayField+'"]]}</li>',"</tpl>","</ul>");f.tpl=Ext.create("Ext.XTemplate",c);if(f.pageSize){f.pagingToolbar=f.createPagingToolbar()}f.callParent();Ext.applyIf(f.renderSelectors,{listEl:".list-ct"})},createPagingToolbar:function(){return Ext.widget("pagingtoolbar",{pageSize:this.pageSize,store:this.store,border:false})},onRender:function(){var d=this;var c=d.pagingToolbar;d.callParent(arguments);if(c){c.render(d.el)}},bindStore:function(c,d){var f=this;var e=f.pagingToolbar;f.callParent(arguments);if(e){e.bindStore(c,d)}},getTargetEl:function(){return this.listEl||this.el},getInnerTpl:function(c){return"{"+c+"}"},refresh:function(){var c=this;c.callParent();if(c.isVisible()){c.refreshed++;c.doComponentLayout();c.refreshed--}},initAria:function(){this.callParent();var c=this.getSelectionModel();var e=c.getSelectionMode();var d=this.getActionEl();if(e!=="SINGLE"){d.dom.setAttribute("aria-multiselectable",true)}},onDestroy:function(){Ext.destroyMembers(this,"pagingToolbar","listEl");this.callParent()}});Ext.define("Totem.ux.form.GroupingComboBox",{extend:"Ext.form.field.ComboBox",requires:["Totem.ux.view.GroupingList"],alias:["widget.groupingcombobox","widget.groupingcombo"],initComponent:function(){var e=this;if(!e.displayTpl){var f=[],c='<tpl for=".">{0}</tpl>';if(Ext.isArray(e.groupField)){for(var d=0;d<e.groupField.length;d++){f.push('{[values["'+e.groupField[d]+'"]]}')}}else{f.push('{[values["'+e.groupField+'"]]}')}f.push('{[values["'+e.displayField+'"]]}');e.displayTpl=Ext.String.format(c,f.join(this.displaySeparator||" "))}e.callParent()},createPicker:function(){var e=this,c,f=Ext.baseCSSPrefix+"menu",d=Ext.apply({selModel:{mode:e.multiSelect?"SIMPLE":"SINGLE"},floating:true,hidden:true,ownerCt:e.ownerCt,cls:e.el.up("."+f)?f:"",store:e.store,groupField:e.groupField,displayField:e.displayField,focusOnToFront:false,pageSize:e.pageSize},e.listConfig,e.defaultListConfig);c=e.picker=Ext.create("Totem.ux.view.GroupingList",d);e.mon(c,{itemclick:e.onItemClick,refresh:e.onListRefresh,scope:e});e.mon(c.getSelectionModel(),"selectionchange",e.onListSelectionChange,e);return c}})});
var clipboardDatasources=undefined;var workspaceDatasources={name:"datasources",current:null,datasources:[],propertyData:null,properySource:null,init:function(){Ext.define("datasourceModel",{extend:"Ext.data.Model",fields:[{name:"Id",type:"int"},{name:"title",type:"string"},{name:"groupid",type:"int"},{name:"driver",type:"string"},{name:"host",type:"string"},{name:"datastore",type:"string"},{name:"user",type:"string"},{name:"password",type:"string"}]});Ext.define("treeModel",{extend:"Ext.data.Model",fields:[{name:"Id",type:"int"},{name:"title",type:"string"},{name:"nodek",type:"string"},{name:"text",type:"string"},{name:"groupid",type:"int"}]})},drivers:Ext.create("Ext.data.Store",{fields:["title","value"],data:[{title:"MySQL",value:"MYSQL"},{title:"Microsoft SQLServer",value:"MSSQL"},{title:"Oracle",value:"ORACLE"},{title:"PostgreSQL",value:"PGSQL"}]}),menuDatasources:new Ext.menu.Menu({items:[{text:"Modifier la source de données",key:"moddatasource"},{text:"Supprimer la source de données",key:"deldatasource"},{xtype:"menuseparator"},{text:"Copier",key:"copydatasource"},{text:"Couper",key:"cutdatasource"}],listeners:{click:function(c,a){switch(a.key){case"moddatasource":workspaceDatasources.gotoDatasource(workspaceDatasources.menuDatasources.rec);break;case"deldatasource":var b=workspaceDatasources.menuDatasources.rec;Ext.MessageBox.show({title:"Totem : Suppression de source de données",msg:"Etes-vous certain de vouloir supprimer la source de données [ "+b.raw.title+" ] ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspaceDatasources.itemDatasources,{msg:"Suppression en cours ..."});e.show();symfony("delete","datasource","datasource",{id:b.raw.Id},function(g){b.remove(true);workspaceDatasources.autoCloseCenterTab();f.hide();e.hide()})}}});break;case"copydatasource":workspaceDatasources.copy(workspaceDatasources.menuDatasources.rec);break;case"cutdatasource":workspaceDatasources.cut(workspaceDatasources.menuDatasources.rec);break}}}}),menuGroupDatasources:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{text:"Modifier ce groupe",key:"modgroup"},{text:"Supprimer ce groupe",key:"delgroup"},{xtype:"menuseparator"},{text:"Copier",key:"copygroup"},{text:"Couper",key:"cutgroup"},{id:"datasourcepaste",text:"Coller",key:"paste",disabled:true},{xtype:"menuseparator"},{text:"Ajouter une source de données",key:"adddatasource"}],listeners:{click:function(c,a){switch(a.key){case"copygroup":workspaceDatasources.copy(workspaceDatasources.menuGroupDatasources.rec);break;case"cutgroup":workspaceDatasources.cut(workspaceDatasources.menuGroupDatasources.rec);break;case"adddatasource":workspaceDatasources.newDatasource(workspaceDatasources.menuGroupDatasources.rec);break;case"paste":workspaceDatasources.paste(workspaceDatasources.menuGroupDatasources.rec);break;case"addgroup":workspaceDatasources.groupForm.load("Nouveau groupe","new",workspaceDatasources.menuGroupDatasources.rec).show();break;case"modgroup":workspaceDatasources.groupForm.load("Modifier un groupe","update",workspaceDatasources.menuGroupDatasources.rec).show();break;case"delgroup":var b=workspaceDatasources.menuGroupDatasources.rec;Ext.MessageBox.show({title:"Totem : Suppression de groupe",msg:"Etes-vous certain de vouloir supprimer le groupe [ "+b.raw.title+" ] et tous les éléments qu'il contient ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspaceDatasources.itemDatasources,{msg:"Suppression en cours ..."});e.show();symfony("delete","group","datasource",{id:b.raw.Id},function(g){b.remove(true);workspaceDatasources.autoCloseCenterTab();f.hide();e.hide()})}}});break}}}}),copy:function(a){clipboardDatasources={item:a,action:"copy"};Ext.getCmp("datasourcepaste").setDisabled(false);if(a.raw.nodek=="groupdatasource"){Ext.getCmp("datasourcepasteroot").setDisabled(false)}},cut:function(a){clipboardDatasources={item:a,action:"cut"};Ext.getCmp("datasourcepaste").setDisabled(false);if(a.raw.nodek=="groupdatasource"){Ext.getCmp("datasourcepasteroot").setDisabled(false)}},paste:function(d){var b=clipboardDatasources.item;if(clipboardDatasources.action=="cut"){if(clipboardDatasources.item.raw.nodek=="datasource"){var a={id:clipboardDatasources.item.raw.Id,groupid:d.raw.Id};symfony("save","datasource","datasource",a,function(e){if(workspaceDatasources.current!=null&&workspaceDatasources.current.Id==a.id){workspaceDatasources.current.groupid=a.groupid}d.appendChild(b)})}else{if(clipboardDatasources.item.raw.nodek=="groupdatasource"){var c={id:clipboardDatasources.item.raw.Id,groupid:d.raw.Id};symfony("save","group","datasource",c,function(e){d.appendChild(b)})}}}else{if(clipboardDatasources.item.raw.nodek=="datasource"){var a={id:clipboardDatasources.item.raw.Id,groupid:d.raw.Id};symfony("clone","datasource","datasource",a,function(e){d.appendChild(e.data)})}else{if(clipboardDatasources.item.raw.nodek=="groupdatasource"){var c={id:clipboardDatasources.item.raw.Id,groupid:d.raw.Id};symfony("clone","group","datasource",c,function(e){d.appendChild(e.data)})}}}clipboardDatasources=null;Ext.getCmp("datasourcepaste").setDisabled(true);Ext.getCmp("datasourcepasteroot").setDisabled(true)},menuRootGroupDatasources:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{xtype:"menuseparator"},{id:"datasourcepasteroot",text:"Coller",key:"paste",disabled:true}],listeners:{click:function(b,a){switch(a.key){case"addgroup":workspaceDatasources.groupForm.load("Nouveau groupe","new",workspaceDatasources.menuGroupDatasources.rec).show();break;case"paste":workspaceDatasources.paste(workspaceDatasources.menuGroupDatasources.rec);break}}}}),groupForm:{load:function(f,c,e){var d=null;var b=null;if(c=="new"){d={raw:{Id:0,title:"",text:""}};b=e}if(c=="update"){d=e;b=e.parentNode}var a=new Ext.form.Panel({defaults:{labelWidth:150},width:500,height:400,title:f,floating:true,closable:true,modal:true,frame:true,bodyStyle:"padding: 10px 10px 0 10px; background-color:#dfeaf2",layout:{type:"vbox",align:"stretch"},items:[{id:"name",xtype:"textfield",fieldLabel:"Name",name:"name",value:d.raw.title},{xtype:"displayfield",fieldLabel:"Parent",name:"parent",value:(b.raw.Id==0||b.raw.Id==null)?"(Racine)":b.raw.title},{xtype:"tabpanel",flex:1,frame:true,bodyStyle:"padding: 10px 10px 0 10px;",items:[{title:"Info",items:[{xtype:"textfield",fieldLabel:"Country",name:"country"}]},{title:"Contact",items:[{xtype:"textfield",fieldLabel:"Email",name:"email"}]}]}],buttons:[{text:"Enregistrer",handler:function(){var h=a.items.get("name").value;var g=(b.raw.Id)?b.raw.Id:0;group={id:d.raw.Id,title:h,groupid:g};symfony("save","group","datasource",group,function(i){if(c=="new"){b.insertChild(-1,{Id:i.data.Id,title:group.title,text:group.title});if(!b.isExpanded()){b.expand()}}if(c=="update"){d.set("text",group.title);d.raw.text=group.title;d.raw.title=group.title;d.commit()}a.close()})}},{text:"Annuler",handler:function(){a.close()}}]});return a}},autoCloseCenterTab:function(){centerPanel.items.each(function(c,b,d){if("datasource" in c&&c.datasource.Id!=0){var a={id:c.datasource.Id};symfony("exists","datasource","datasource",a,function(e){if(e.data.response=="false"){if(workspaceDatasources.current.Id==a.id){workspaceDatasources.current=null}centerPanel.remove(c)}})}})},newDatasource:function(b){var a={groupid:b.raw.Id,title:"Nouvelle source de données"};symfony("save","datasource","datasource",a,function(c){var d=b.insertChild(-1,c.data);workspaceDatasources.gotoDatasource(d)})},gotoDatasource:function(a){workspaceDatasources.getDatasource(a.raw.Id,function(b){var c=false;centerPanel.items.each(function(f,e,g){if(f.datasource&&b.Id==f.datasource.Id){c=true;centerPanel.setActiveTab(f)}});if(!c){var d=Ext.create("Ext.Panel",{title:a.raw.text,iconCls:"icon-database",html:"contenu",closable:true,active:true,tbar:[{text:"Enregistrer",key:"save",handler:workspaceDatasources.task},{text:"Tester",key:"test",handler:workspaceDatasources.task}]});d.datasource=a.raw;d.rec=a;d.workspace=workspaceDatasources;d.propertySource={"(name)":b.title,description:Ext.encode({description_resume:"",description_details:""}),driver:"ORACLE",host:b.host,datastore:b.datastore,user:b.user,password:b.password};centerPanel.add(d);centerPanel.setActiveTab(d)}})},onCenterTabChange:function(b,a){if("datasource" in a){workspaceDatasources.current=a.datasource;workspaceDatasources.propertyData.setSource(a.propertySource)}},itemDatasources:Ext.create("Ext.tree.Panel",{title:"Sources de données",store:Ext.create("Ext.data.TreeStore",{model:"treeModel",proxy:{type:"memory"}}),viewConfig:{plugins:{ptype:"treeviewdragdrop"},listeners:{beforedrop:function(d,f,e,b,a,c){if((b=="before"||b=="after")&&e.parentNode.raw.text=="Root"){if(f.records[0].raw.nodek=="datasource"){a.cancelDrop()}}},drop:function(c,e,d,b){if(e.records[0].raw.nodek=="groupdatasource"){var f={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","group","datasource",f,function(g){})}else{if(e.records[0].raw.nodek=="datasource"){var a={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","datasource","datasource",a,function(g){if(workspaceDatasources.current.Id==a.id){workspaceDatasources.current.groupid=a.groupid}})}}}}},rootVisible:false,listeners:{afterrender:function(a,b){var c=new Ext.LoadMask(workspaceDatasources.itemDatasources,{msg:"Veuillez patienter ..."});c.show();symfony("list","datasource","datasource",{},function(d){var f=workspaceDatasources.itemDatasources.getStore();var e=f.setRootNode({children:d.data});Ext.apply(workspaceDatasources.itemDatasources,{store:f});c.hide()})},itemdblclick:function(c,f,e,d,a){if(f.get("leaf")){var b=new Ext.LoadMask(centerPanel,{msg:"Chargement en cours ..."});b.show();symfony("get","datasource","datasource",{id:f.raw.Id},function(g){f.raw=g.data;workspaceDatasources.gotoDatasource(f);b.hide()})}},containercontextmenu:function(b,a){workspaceDatasources.menuGroupDatasources.rec=workspaceDatasources.itemDatasources.store.tree.root;workspaceDatasources.menuRootGroupDatasources.showAt(a.getXY());a.stopEvent()},itemcontextmenu:function(b,e,d,c,a){if(e.get("leaf")){workspaceDatasources.menuDatasources.rec=e;workspaceDatasources.menuDatasources.showAt(a.getXY())}else{workspaceDatasources.menuGroupDatasources.rec=e;workspaceDatasources.menuGroupDatasources.showAt(a.getXY())}a.stopEvent()}}}),setProperties:function(a){$.each(a,function(b,c){workspaceDatasources.propertySource[b]=c});workspaceDatasources.propertyData.setSource(workspaceDatasources.propertySource)},set:function(b,d){currentWorkspace=workspaceDatasources;bottomPanel.hide();propertyPanel.removeAll();workspaceDatasources.propertySource={"(name)":"name",description:Ext.encode({description_resume:"",description_details:""}),driver:"",host:"",datastore:"",user:"",password:""};workspaceDatasources.propertyData=Ext.create("Ext.grid.property.Grid",{title:"Propriétés",sortableColumns:false,propertyNames:{"(name)":"(Nom)",description:"Description",driver:"Pilote",host:"Hôte",datastore:"Schéma",user:"Utilisateur",password:"Mot de passe"},listeners:{propertychange:function(k,h,j,g){if(h=="(name)"){var i=centerPanel.getActiveTab();i.rec.set("text",j);i.rec.raw.text=j;i.rec.raw.title=j;i.rec.commit();i.setTitle(j)}}},customEditors:{description:{xtype:"descriptionfield"},driver:Ext.create("Ext.form.ComboBox",{store:workspaceDatasources.drivers,queryMode:"local",displayField:"title",valueField:"value"}),password:{inputType:"password"}},customRenderers:{driver:function(g){workspaceDatasources.drivers.findBy(function(h){if(h.get("value")===g){g=h.get("title");return true}});return g},description:function(g){var j=Ext.decode(g),k=j.description_details,h=j.description_resume,i="";i+="<b>"+h+"</b>: ";i+="<i>"+k+"</i>";return i},password:function(g){return Array(g.length).join("*")}},source:workspaceDatasources.propertySource});propertyPanel.add(workspaceDatasources.propertyData);propertyPanel.add(aboutTab());propertyPanel.setActiveTab(workspaceDatasources.propertyData);var f=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1},{text:"Titre de la colonne",flex:1,sortable:1},{text:"Cadrage",flex:1,sortable:1},{text:"Format de date",flex:1,sortable:1},{text:"Largeur de la colonne",flex:1,sortable:1}]});var e=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1}]});bottomPanel.removeAll();var c=Ext.create("Ext.Panel",{title:"Paramètres d'affichage des colonnes",iconCls:"tabs",closable:false,items:[f]});var a=Ext.create("Ext.Panel",{title:"Résultats sources de données",iconCls:"tabs",html:"center south",closable:false,items:[e]});bottomPanel.add(c);bottomPanel.add(a);bottomPanel.setActiveTab(c);d()},getDatasource:function(b,a){symfony("get","datasource","datasource",{id:b},function(c){if(workspaceDatasources.datasources[c.data.Id]===undefined){workspaceDatasources.datasources[c.data.Id]={}}a(c.data)})},task:function(c){switch(c.key){case"save":var d=workspaceDatasources.propertyData.source["(name)"];workspaceDatasources.current.title=d;workspaceDatasources.current.driver=workspaceDatasources.propertyData.source.driver;workspaceDatasources.current.host=workspaceDatasources.propertyData.source.host;workspaceDatasources.current.datastore=workspaceDatasources.propertyData.source.datastore;workspaceDatasources.current.user=workspaceDatasources.propertyData.source.user;workspaceDatasources.current.password=workspaceDatasources.propertyData.source.password;var b={id:workspaceDatasources.current.Id,title:workspaceDatasources.current.title,groupid:workspaceDatasources.current.groupid,driver:workspaceDatasources.current.driver,host:workspaceDatasources.current.host,datastore:workspaceDatasources.current.datastore,user:workspaceDatasources.current.user,password:workspaceDatasources.current.password};var a=new Ext.LoadMask(centerPanel,{msg:"Sauvegarde en cours ..."});a.show();symfony("save","datasource","datasource",b,function(e){a.hide()});break}}};
Ext.require(["Ext.TabPanel","Extensible.calendar.data.MemoryEventStore","Extensible.calendar.CalendarPanel"]);var clipboardPlannings=undefined;var workspacePlannings={name:"plannings",current:null,plannings:[],propertyData:null,properySource:null,storecouleur:null,init:function(){Ext.define("treeModel",{extend:"Ext.data.Model",fields:[{name:"Id",type:"int"},{name:"title",type:"string"},{name:"nodek",type:"string"},{name:"text",type:"string"},{name:"groupid",type:"int"}]});Extensible.calendar.data.EventMappings={EventId:{name:"ID",mapping:"Id"},CalendarId:{name:"CalID",mapping:"usergroupid"},Title:{name:"EvtTitle",mapping:"title"},StartDate:{name:"StartDt",mapping:"startdate",type:"date"},EndDate:{name:"EndDt",mapping:"enddate",type:"date"},RRule:{name:"RecurRule",mapping:"recurrule"},Location:{name:"Location",mapping:"location"},Notes:{name:"Desc",mapping:"notes"},Url:{name:"LinkUrl",mapping:"url"},IsAllDay:{name:"AllDay",mapping:"isallday",type:"boolean"},Reminder:{name:"Reminder",mapping:"reminder"},ReportId:{name:"ReportId",mapping:"reportid",type:"int"},CreatedBy:{name:"CreatedBy",mapping:"createdby"}};Extensible.calendar.data.EventModel.reconfigure();Extensible.calendar.data.CalendarMappings={CalendarId:{name:"ID",mapping:"cal_id"},Title:{name:"CalTitle",mapping:"cal_title",type:"string"},Description:{name:"Desc",mapping:"cal_desc",type:"string"},ColorId:{name:"Color",mapping:"cal_color",type:"int"},IsHidden:{name:"Hidden",mapping:"hidden",type:"boolean"}};Extensible.calendar.data.CalendarModel.reconfigure();symfony("listall","report","report",{},function(a){dataReports=a.data;Ext.override(Extensible.calendar.form.EventWindow,{titleTextAdd:"Programmer une génération automatique de rapport",labelWidth:150,width:760,initRefs:function(){this.callParent();this.reportField=this.down("#"+this.id+"-report")},show:function(d,c){this.callParent(arguments);var e=Extensible.calendar.data.EventMappings;if(d.data){var b=d;this.reportField.setValue(b.data[e.ReportId.name])}},getFooterBarConfig:function(){this.enableEditDetails=false;return this.callParent()},getFormItemConfigs:function(){var b=[{xtype:"textfield",itemId:this.id+"-title",name:Extensible.calendar.data.EventMappings.Title.name,fieldLabel:this.titleLabelText,anchor:"100%"},{xtype:"extensible.daterangefield",itemId:this.id+"-dates",name:"dates",anchor:"95%",singleLine:true,fieldLabel:this.datesLabelText},{itemId:this.id+"-report",anchor:"100%",fieldLabel:"Rapport",xtype:"groupingcombobox",name:Extensible.calendar.data.EventMappings.ReportId.name,allowBlank:false,groupField:["grouptree"],valueField:"Id",displayField:"text",displaySeparator:" ❱ ",queryMode:"local",editable:false,typeAhead:true,store:{fields:[{name:"Id",type:"int"},{name:"grouptree",type:"string"},{name:"text",type:"string"}],sorters:[{property:"grouptree",direction:"ASC"}],data:dataReports}}];if(this.calendarStore){b.push({xtype:"extensible.calendarcombo",itemId:this.id+"-calendar",editable:false,forceSelection:true,allowBlank:false,name:Extensible.calendar.data.EventMappings.CalendarId.name,anchor:"100%",fieldLabel:"Groupe d'utilisateurs",store:this.calendarStore})}return b}})})},menuPlannings:new Ext.menu.Menu({items:[{text:"Modifier la tâche plannifiée",key:"modplanning"},{text:"Supprimer la tâche plannifiée",key:"delplanning"},{xtype:"menuseparator"},{text:"Copier",key:"copyplanning"},{text:"Couper",key:"cutplanning"}],listeners:{click:function(c,a){switch(a.key){case"modplanning":workspacePlannings.gotoPlanning(workspacePlannings.menuPlannings.rec);break;case"delplanning":var b=workspacePlannings.menuPlannings.rec;Ext.MessageBox.show({title:"Totem : Suppression de tâche plannifiée",msg:"Etes-vous certain de vouloir supprimer la tâche plannifiée [ "+b.raw.title+" ] ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspacePlannings.itemPlannings,{msg:"Suppression en cours ..."});e.show();symfony("delete","planning","planning",{id:b.raw.Id},function(g){b.remove(true);workspacePlannings.autoCloseCenterTab();f.hide();e.hide()})}}});break;case"copyplanning":workspacePlannings.copy(workspacePlannings.menuPlannings.rec);break;case"cutplanning":workspacePlannings.cut(workspacePlannings.menuPlannings.rec);break}}}}),menuGroupPlannings:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{text:"Modifier ce groupe",key:"modgroup"},{text:"Supprimer ce groupe",key:"delgroup"},{xtype:"menuseparator"},{text:"Copier",key:"copygroup"},{text:"Couper",key:"cutgroup"},{id:"planningpaste",text:"Coller",key:"paste",disabled:true},{xtype:"menuseparator"},{text:"Ajouter une tâche plannifiée",key:"addplanning"}],listeners:{click:function(c,a){switch(a.key){case"copygroup":workspacePlannings.copy(workspacePlannings.menuGroupPlannings.rec);break;case"cutgroup":workspacePlannings.cut(workspacePlannings.menuGroupPlannings.rec);break;case"addplanning":workspacePlannings.newPlanning(workspacePlannings.menuGroupPlannings.rec);break;case"paste":workspacePlannings.paste(workspacePlannings.menuGroupPlannings.rec);break;case"addgroup":workspacePlannings.groupForm.load("Nouveau groupe","new",workspacePlannings.menuGroupPlannings.rec).show();break;case"modgroup":workspacePlannings.groupForm.load("Modifier un groupe","update",workspacePlannings.menuGroupPlannings.rec).show();break;case"delgroup":var b=workspacePlannings.menuGroupPlannings.rec;Ext.MessageBox.show({title:"Totem : Suppression de groupe",msg:"Etes-vous certain de vouloir supprimer le groupe [ "+b.raw.title+" ] et tous les éléments qu'il contient ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspacePlannings.itemPlannings,{msg:"Suppression en cours ..."});e.show();symfony("delete","group","planning",{id:b.raw.Id},function(g){b.remove(true);workspacePlannings.autoCloseCenterTab();f.hide();e.hide()})}}});break}}}}),copy:function(a){clipboardPlannings={item:a,action:"copy"};Ext.getCmp("planningpaste").setDisabled(false);if(a.raw.nodek=="groupplanning"){Ext.getCmp("planningpasteroot").setDisabled(false)}},cut:function(a){clipboardPlannings={item:a,action:"cut"};Ext.getCmp("planningpaste").setDisabled(false);if(a.raw.nodek=="groupplanning"){Ext.getCmp("planningpasteroot").setDisabled(false)}},paste:function(d){var b=clipboardPlannings.item;if(clipboardPlannings.action=="cut"){if(clipboardPlannings.item.raw.nodek=="planning"){var a={id:clipboardPlannings.item.raw.Id,groupid:d.raw.Id};symfony("save","planning","planning",a,function(e){if(workspacePlannings.current!=null&&workspacePlannings.current.Id==a.id){workspacePlannings.current.groupid=a.groupid}d.appendChild(b)})}else{if(clipboardPlannings.item.raw.nodek=="groupplanning"){var c={id:clipboardPlannings.item.raw.Id,groupid:d.raw.Id};symfony("save","group","planning",c,function(e){d.appendChild(b)})}}}else{if(clipboardPlannings.item.raw.nodek=="planning"){var a={id:clipboardPlannings.item.raw.Id,groupid:d.raw.Id};symfony("clone","planning","planning",a,function(e){d.appendChild(e.data)})}else{if(clipboardPlannings.item.raw.nodek=="groupplanning"){var c={id:clipboardPlannings.item.raw.Id,groupid:d.raw.Id};symfony("clone","group","planning",c,function(e){d.appendChild(e.data)})}}}clipboardPlannings=null;Ext.getCmp("planningpaste").setDisabled(true);Ext.getCmp("planningpasteroot").setDisabled(true)},menuRootGroupPlannings:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{xtype:"menuseparator"},{id:"planningpasteroot",text:"Coller",key:"paste",disabled:true}],listeners:{click:function(b,a){switch(a.key){case"addgroup":workspacePlannings.groupForm.load("Nouveau groupe","new",workspacePlannings.menuGroupPlannings.rec).show();break;case"paste":workspacePlannings.paste(workspacePlannings.menuGroupPlannings.rec);break}}}}),groupForm:{load:function(f,c,e){var d=null;var b=null;if(c=="new"){d={raw:{Id:0,title:"",text:""}};b=e}if(c=="update"){d=e;b=e.parentNode}var a=new Ext.form.Panel({defaults:{labelWidth:150},width:500,height:400,title:f,floating:true,closable:true,modal:true,frame:true,bodyStyle:"padding: 10px 10px 0 10px; background-color:#dfeaf2",layout:{type:"vbox",align:"stretch"},items:[{id:"name",xtype:"textfield",fieldLabel:"Name",name:"name",value:d.raw.title},{xtype:"displayfield",fieldLabel:"Parent",name:"parent",value:(b.raw.Id==0||b.raw.Id==null)?"(Racine)":b.raw.title},{xtype:"tabpanel",flex:1,frame:true,bodyStyle:"padding: 10px 10px 0 10px;",items:[{title:"Info",items:[{xtype:"textfield",fieldLabel:"Country",name:"country"}]},{title:"Contact",items:[{xtype:"textfield",fieldLabel:"Email",name:"email"}]}]}],buttons:[{text:"Enregistrer",handler:function(){var h=a.items.get("name").value;var g=(b.raw.Id)?b.raw.Id:0;group={id:d.raw.Id,title:h,groupid:g};symfony("save","group","planning",group,function(i){if(c=="new"){b.insertChild(-1,{Id:i.data.Id,title:group.title,text:group.title});if(!b.isExpanded()){b.expand()}}if(c=="update"){d.set("text",group.title);d.raw.text=group.title;d.raw.title=group.title;d.commit()}a.close()})}},{text:"Annuler",handler:function(){a.close()}}]});return a}},autoCloseCenterTab:function(){centerPanel.items.each(function(b,a,d){if("planning" in b&&b.planning.Id!=0){var c={id:b.planning.Id};symfony("exists","planning","planning",c,function(e){if(e.data.response=="false"){if(workspacePlannings.current.Id==c.id){workspacePlannings.current=null}centerPanel.remove(b)}})}})},newPlanning:function(b){var a={groupid:b.raw.Id,title:"Nouvelle tâche plannifiée"};symfony("save","planning","planning",a,function(c){var d=b.insertChild(-1,c.data);workspacePlannings.gotoPlanning(d)})},gotoPlanning:function(a){workspacePlannings.getPlanning(a.raw.Id,function(c){var b=false;centerPanel.items.each(function(e,d,f){if(e.planning&&c.Id==e.planning.Id){b=true;centerPanel.setActiveTab(e)}});if(!b){symfony("get","events","planning",{planningid:a.raw.Id},function(d){var e=d.data;Ext.define("Extensible.totem.calendar.data.Events",{constructor:function(){return{evts:e}}});symfony("list","group","user",{},function(f){var h=f.data;Ext.define("Extensible.totem.calendar.data.Calendar",{constructor:function(){var j=[];$.each(h,function(m,n){var l=Math.abs(n.color.replace("x-cal-","").replace("-ad",""))+0;var k={cal_id:n.Id,cal_color:l,cal_title:n.text};j.push(k)});return{calendars:j}}});var g=Ext.create("Extensible.calendar.data.MemoryEventStore",{data:Ext.create("Extensible.totem.calendar.data.Events")});workspacePlannings.calendarStore=Ext.create("Extensible.calendar.data.MemoryCalendarStore",{data:Ext.create("Extensible.totem.calendar.data.Calendar")});var i=Ext.create("Ext.Panel",{title:a.raw.text,iconCls:"icon-planning",closable:true,active:true,tbar:[{text:"Enregistrer",key:"save",handler:workspacePlannings.task},{text:"Analyser",key:"analyse",handler:workspacePlannings.task},{text:"Exécuter",key:"run",handler:workspacePlannings.task}],items:[{xtype:"extensible.calendarpanel",eventStore:g,calendarStore:workspacePlannings.calendarStore,height:1098,activeItem:1,editModal:true,listeners:{eventclick:{fn:function(l,j,k){},scope:this},dayclick:{fn:function(m,l,k,j){},scope:this},eventupdate:{fn:function(l,k){var j={id:k.data[Extensible.calendar.data.EventMappings.EventId.name],title:k.data[Extensible.calendar.data.EventMappings.Title.name],planningid:a.raw.Id,usergroupid:k.data[Extensible.calendar.data.EventMappings.CalendarId.name],startdate:""+k.data[Extensible.calendar.data.EventMappings.StartDate.name],enddate:""+k.data[Extensible.calendar.data.EventMappings.EndDate.name],recurrule:k.data[Extensible.calendar.data.EventMappings.RRule.name],location:k.data[Extensible.calendar.data.EventMappings.Location.name],notes:k.data[Extensible.calendar.data.EventMappings.Notes.name],url:k.data[Extensible.calendar.data.EventMappings.Url.name],isallday:k.data[Extensible.calendar.data.EventMappings.IsAllDay.name],reminder:k.data[Extensible.calendar.data.EventMappings.Reminder.name],reportid:k.data[Extensible.calendar.data.EventMappings.ReportId.name],createdby:k.data[Extensible.calendar.data.EventMappings.CreatedBy.name]};symfony("save","event","planning",j,function(m){})},scope:this},eventadd:{fn:function(l,k){var j={title:k.data[Extensible.calendar.data.EventMappings.Title.name],planningid:a.raw.Id,usergroupid:k.data[Extensible.calendar.data.EventMappings.CalendarId.name],startdate:""+k.data[Extensible.calendar.data.EventMappings.StartDate.name],enddate:""+k.data[Extensible.calendar.data.EventMappings.EndDate.name],recurrule:k.data[Extensible.calendar.data.EventMappings.RRule.name],location:k.data[Extensible.calendar.data.EventMappings.Location.name],notes:k.data[Extensible.calendar.data.EventMappings.Notes.name],url:k.data[Extensible.calendar.data.EventMappings.Url.name],isallday:k.data[Extensible.calendar.data.EventMappings.IsAllDay.name],reminder:k.data[Extensible.calendar.data.EventMappings.Reminder.name],reportid:k.data[Extensible.calendar.data.EventMappings.ReportId.name],createdby:k.data[Extensible.calendar.data.EventMappings.CreatedBy.name]};symfony("save","event","planning",j,function(m){k.data[Extensible.calendar.data.EventMappings.EventId.name]=m.data.Id})},scope:this},eventdelete:{fn:function(k,j){this.eventStore.remove(j);alert(j.data[Extensible.calendar.data.EventMappings.Title.name])},scope:this}}}]});i.planning=a.raw;i.rec=a;i.workspace=workspacePlannings;i.propertySource={"(name)":c.title,description:Ext.encode({description_resume:"",description_details:""}),motscles:"",environnement:"",nodek:"",publiee:true};centerPanel.add(i);centerPanel.setActiveTab(i)})})}})},onCenterTabChange:function(b,a){if("planning" in a){workspacePlannings.current=a.planning;workspacePlannings.propertyData.setSource(a.propertySource)}},itemPlannings:Ext.create("Ext.tree.Panel",{title:"Tâches plannifiées",store:Ext.create("Ext.data.TreeStore",{model:"treeModel",proxy:{type:"memory"}}),viewConfig:{plugins:{ptype:"treeviewdragdrop"},listeners:{beforedrop:function(d,f,e,b,a,c){if((b=="before"||b=="after")&&e.parentNode.raw.text=="Root"){if(f.records[0].raw.nodek=="planning"){a.cancelDrop()}}},drop:function(c,e,d,a){if(e.records[0].raw.nodek=="groupplanning"){var f={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","group","planning",f,function(g){})}else{if(e.records[0].raw.nodek=="planning"){var b={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","planning","planning",b,function(g){if(workspacePlannings.current.Id==b.id){workspacePlannings.current.groupid=b.groupid}})}}}}},rootVisible:false,listeners:{afterrender:function(a,b){var c=new Ext.LoadMask(workspacePlannings.itemPlannings,{msg:"Veuillez patienter ..."});c.show();symfony("list","planning","planning",{},function(d){var f=workspacePlannings.itemPlannings.getStore();var e=f.setRootNode({children:d.data});Ext.apply(workspacePlannings.itemPlannings,{store:f});c.hide()})},itemdblclick:function(c,f,e,d,a){if(f.get("leaf")){var b=new Ext.LoadMask(centerPanel,{msg:"Chargement en cours ..."});b.show();symfony("get","planning","planning",{id:f.raw.Id},function(g){f.raw=g.data;workspacePlannings.gotoPlanning(f);b.hide()})}},containercontextmenu:function(b,a){workspacePlannings.menuGroupPlannings.rec=workspacePlannings.itemPlannings.store.tree.root;workspacePlannings.menuRootGroupPlannings.showAt(a.getXY());a.stopEvent()},itemcontextmenu:function(b,e,d,c,a){if(e.get("leaf")){workspacePlannings.menuPlannings.rec=e;workspacePlannings.menuPlannings.showAt(a.getXY())}else{workspacePlannings.menuGroupPlannings.rec=e;workspacePlannings.menuGroupPlannings.showAt(a.getXY())}a.stopEvent()}}}),setProperties:function(a){$.each(a,function(b,c){workspacePlannings.propertySource[b]=c});workspacePlannings.propertyData.setSource(workspacePlannings.propertySource)},set:function(b,d){currentWorkspace=workspacePlannings;bottomPanel.hide();propertyPanel.removeAll();workspacePlannings.propertySource={"(name)":"name",description:Ext.encode({description_resume:"",description_details:""}),motscles:"",environnement:"",nodek:"",publiee:true};workspacePlannings.propertyData=Ext.create("Ext.grid.property.Grid",{title:"Propriétés",propertyNames:{"(name)":"(Nom)",description:"Description",motscles:"Mots clés",environnement:"Environnement",nodek:"Groupe",publiee:"Publiée"},listeners:{propertychange:function(k,h,j,g){if(h=="(name)"){var i=centerPanel.getActiveTab();i.rec.set("text",j);i.rec.raw.text=j;i.rec.raw.title=j;i.rec.commit();i.setTitle(j)}}},customEditors:{description:{xtype:"descriptionfield"},groupe:{xtype:"combobox"},environnement:{xtype:"combobox"}},customRenderers:{description:function(g){var j=Ext.decode(g),k=j.description_details,h=j.description_resume,i="";i+="<b>"+h+"</b>: ";i+="<i>"+k+"</i>";return i}},source:workspacePlannings.propertySource});propertyPanel.add(workspacePlannings.propertyData);propertyPanel.add(aboutTab());propertyPanel.setActiveTab(workspacePlannings.propertyData);var f=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1},{text:"Titre de la colonne",flex:1,sortable:1},{text:"Cadrage",flex:1,sortable:1},{text:"Format de date",flex:1,sortable:1},{text:"Largeur de la colonne",flex:1,sortable:1}]});var e=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1}]});bottomPanel.removeAll();var c=Ext.create("Ext.Panel",{title:"Paramètres d'affichage des colonnes",iconCls:"tabs",closable:false,items:[f]});var a=Ext.create("Ext.Panel",{title:"Résultats tâches plannifiées",iconCls:"tabs",html:"center south",closable:false,items:[e]});bottomPanel.add(c);bottomPanel.add(a);bottomPanel.setActiveTab(c);d()},getPlanning:function(b,a){symfony("get","planning","planning",{id:b},function(c){if(workspacePlannings.plannings[c.data.Id]===undefined){workspacePlannings.plannings[c.data.Id]={}}a(c.data)})},task:function(b){switch(b.key){case"save":var d=workspacePlannings.propertyData.source["(name)"];workspacePlannings.current.title=d;var c={id:workspacePlannings.current.Id,title:workspacePlannings.current.title,groupid:workspacePlannings.current.groupid};var a=new Ext.LoadMask(centerPanel,{msg:"Sauvegarde en cours ..."});a.show();symfony("save","planning","planning",c,function(e){a.hide()});break}}};
function parseSQLCode(a){var b="text/x-mariadb";workspaceQueries.queries[a].editor=CodeMirror.fromTextArea(document.getElementById("codesql"+a),{mode:b,indentWithTabs:true,smartIndent:true,lineNumbers:true,matchBrackets:true,autofocus:true,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{tables:{users:{name:null,score:null,birthDate:null},countries:{name:null,population:null,size:null}}}})}var clipboardQueries=undefined;var workspaceQueries={name:"queries",current:null,currentTab:null,queries:[],propertyData:null,properySource:null,init:function(){Ext.define("variableModel",{extend:"Ext.data.Model",fields:[{name:"Id",type:"int"},{name:"title",type:"string"},{name:"name",type:"string"},{name:"type",type:"string"},{name:"value",type:"string"}]});Ext.define("queryModel",{extend:"Ext.data.Model",fields:[{name:"Id",type:"int"},{name:"title",type:"string"},{name:"alias",type:"string"},{name:"groupid",type:"int"},{name:"content",type:"string"},{name:"description",type:"string"},{name:"motscles",type:"string"},{name:"datasourceid",type:"string"},{name:"publiee",type:"boolean"}]});Ext.define("treeModel",{extend:"Ext.data.Model",fields:[{name:"Id",type:"int"},{name:"title",type:"string"},{name:"nodek",type:"string"},{name:"text",type:"string"},{name:"groupid",type:"int"}]})},menuQueries:new Ext.menu.Menu({items:[{text:"Modifier la requête",key:"modquery"},{text:"Supprimer la requête",key:"delquery"},{xtype:"menuseparator"},{text:"Copier",key:"copyquery",iconCls:"icon-copy"},{text:"Couper",key:"cutquery",iconCls:"icon-cut"}],listeners:{click:function(c,a){switch(a.key){case"modquery":workspaceQueries.gotoQuery(workspaceQueries.menuQueries.rec);break;case"delquery":var b=workspaceQueries.menuQueries.rec;Ext.MessageBox.show({title:"Totem : Suppression de requête",msg:"Etes-vous certain de vouloir supprimer la requête [ "+b.raw.alias+" ] ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspaceQueries.itemQueries,{msg:"Suppression en cours ..."});e.show();symfony("delete","query","query",{id:b.raw.Id},function(g){b.remove(true);workspaceQueries.autoCloseCenterTab();f.hide();e.hide()})}}});break;case"copyquery":workspaceQueries.copy(workspaceQueries.menuQueries.rec);break;case"cutquery":workspaceQueries.cut(workspaceQueries.menuQueries.rec);break}}}}),menuGroupQueries:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{text:"Modifier ce groupe",key:"modgroup"},{text:"Supprimer ce groupe",key:"delgroup"},{xtype:"menuseparator"},{text:"Copier",key:"copygroup",iconCls:"icon-copy-folder"},{text:"Couper",key:"cutgroup",iconCls:"icon-cut"},{id:"querypaste",text:"Coller",key:"paste",disabled:true,iconCls:"icon-paste"},{xtype:"menuseparator"},{text:"Ajouter une requête",key:"addquery"}],listeners:{click:function(c,a){switch(a.key){case"copygroup":workspaceQueries.copy(workspaceQueries.menuGroupQueries.rec);break;case"cutgroup":workspaceQueries.cut(workspaceQueries.menuGroupQueries.rec);break;case"addquery":workspaceQueries.newQuery(workspaceQueries.menuGroupQueries.rec);break;case"paste":workspaceQueries.paste(workspaceQueries.menuGroupQueries.rec);break;case"addgroup":workspaceQueries.groupForm.load("Nouveau groupe","new",workspaceQueries.menuGroupQueries.rec).show();break;case"modgroup":workspaceQueries.groupForm.load("Modifier un groupe","update",workspaceQueries.menuGroupQueries.rec).show();break;case"delgroup":var b=workspaceQueries.menuGroupQueries.rec;Ext.MessageBox.show({title:"Totem : Suppression de groupe",msg:"Etes-vous certain de vouloir supprimer le groupe [ "+b.raw.title+" ] et tous les éléments qu'il contient ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspaceQueries.itemQueries,{msg:"Suppression en cours ..."});e.show();symfony("delete","group","query",{id:b.raw.Id},function(g){b.remove(true);workspaceQueries.autoCloseCenterTab();f.hide();e.hide()})}}});break}}}}),copy:function(a){clipboardQueries={item:a,action:"copy"};Ext.getCmp("querypaste").setDisabled(false);if(a.raw.nodek=="groupquery"){Ext.getCmp("querypasteroot").setDisabled(false)}},cut:function(a){clipboardQueries={item:a,action:"cut"};Ext.getCmp("querypaste").setDisabled(false);if(a.raw.nodek=="groupquery"){Ext.getCmp("querypasteroot").setDisabled(false)}},paste:function(d){var a=clipboardQueries.item;if(clipboardQueries.action=="cut"){if(clipboardQueries.item.raw.nodek=="query"){var b={id:clipboardQueries.item.raw.Id,groupid:d.raw.Id};symfony("save","query","query",b,function(e){if(workspaceQueries.current!=null&&workspaceQueries.current.Id==b.id){workspaceQueries.current.groupid=b.groupid}d.appendChild(a)})}else{if(clipboardQueries.item.raw.nodek=="groupquery"){var c={id:clipboardQueries.item.raw.Id,groupid:d.raw.Id};symfony("save","group","query",c,function(e){d.appendChild(a)})}}}else{if(clipboardQueries.item.raw.nodek=="query"){var b={id:clipboardQueries.item.raw.Id,groupid:d.raw.Id};symfony("clone","query","query",b,function(e){d.appendChild(e.data)})}else{if(clipboardQueries.item.raw.nodek=="groupquery"){var c={id:clipboardQueries.item.raw.Id,groupid:d.raw.Id};symfony("clone","group","query",c,function(e){d.appendChild(e.data)})}}}clipboardQueries=null;Ext.getCmp("querypaste").setDisabled(true);Ext.getCmp("querypasteroot").setDisabled(true)},menuRootGroupQueries:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{xtype:"menuseparator"},{id:"querypasteroot",text:"Coller",key:"paste",disabled:true,iconCls:"icon-paste"}],listeners:{click:function(b,a){switch(a.key){case"addgroup":workspaceQueries.groupForm.load("Nouveau groupe","new",workspaceQueries.menuGroupQueries.rec).show();break;case"paste":workspaceQueries.paste(workspaceQueries.menuGroupQueries.rec);break}}}}),groupForm:{load:function(f,c,e){var d=null;var b=null;if(c=="new"){d={raw:{Id:0,title:"",text:""}};b=e}if(c=="update"){d=e;b=e.parentNode}var a=new Ext.form.Panel({defaults:{labelWidth:150},width:500,height:400,title:f,floating:true,closable:true,modal:true,frame:true,bodyStyle:"padding: 10px 10px 0 10px; background-color:#dfeaf2",layout:{type:"vbox",align:"stretch"},items:[{id:"name",xtype:"textfield",fieldLabel:"Name",name:"name",value:d.raw.title},{xtype:"displayfield",fieldLabel:"Parent",name:"parent",value:(b.raw.Id==0||b.raw.Id==null)?"(Racine)":b.raw.title},{xtype:"tabpanel",flex:1,frame:true,bodyStyle:"padding: 10px 10px 0 10px;",items:[{title:"Info",items:[{xtype:"textfield",fieldLabel:"Country",name:"country"}]},{title:"Contact",items:[{xtype:"textfield",fieldLabel:"Email",name:"email"}]}]}],buttons:[{text:"Enregistrer",handler:function(){var h=a.items.get("name").value;var g=(b.raw.Id)?b.raw.Id:0;group={id:d.raw.Id,title:h,groupid:g};symfony("save","group","query",group,function(i){if(c=="new"){b.insertChild(-1,{Id:i.data.Id,title:group.title,text:group.title,iconCls:"tree-folder"});if(!b.isExpanded()){b.expand()}}if(c=="update"){d.set("text",group.title);d.raw.text=group.title;d.raw.title=group.title;d.commit()}a.close()})}},{text:"Annuler",handler:function(){a.close()}}]});return a}},autoCloseCenterTab:function(){centerPanel.items.each(function(b,a,c){if("query" in b&&b.query.Id!=0){var d={id:b.query.Id};symfony("exists","query","query",d,function(e){if(e.data.response=="false"){if(workspaceQueries.current.Id==d.id){workspaceQueries.current=null}centerPanel.remove(b)}})}})},newQuery:function(b){var a={groupid:b.raw.Id,title:"Nouvelle requête",content:"select * from table;"};symfony("save","query","query",a,function(c){var d=b.insertChild(-1,c.data.Id);workspaceQueries.gotoQuery(d)})},gotoQuery:function(a){workspaceQueries.getQuery(a.raw.Id,function(c){var b=false;centerPanel.items.each(function(f,e,g){if(f.query&&c.Id==f.query.Id){b=true;centerPanel.setActiveTab(f)}});if(!b){var d=Ext.create("Ext.Panel",{title:a.raw.alias,iconCls:"icon-sql",html:"<textarea id='codesql"+c.Id+"' name='codesql'>"+c.content+"</textarea>",closable:true,active:true,tbar:[{text:"Enregistrer",iconCls:"icon-save",key:"save",handler:workspaceQueries.task},{text:"Analyser",iconCls:"icon-analyse",key:"analyse",handler:workspaceQueries.task},{text:"Exécuter",iconCls:"icon-run",key:"run",handler:workspaceQueries.task},{text:"Exporter",iconCls:"icon-run",key:"run",handler:workspaceQueries.task,region:"east"}]});d.query=a.raw;d.rec=a;d.workspace=workspaceQueries;d.propertySource={"(name)":c.title,alias:c.alias,description:Ext.encode({description_resume:"",description_details:""}),motscles:c.motscles,datasourceid:c.datasourceid,publiee:c.publiee};symfony("get","columns","query",{id:a.raw.Id},function(e){var g=[];var f=[];$.each(e.data,function(h,i){g.push(i);if(i.printed){f.push(i)}});d.columnSource=Ext.create("Ext.data.Store",{fields:["Id","type","table","name","len","precision","ordre","displayed","printed","width"],data:g});d.coldata=f;centerPanel.add(d);centerPanel.setActiveTab(d);parseSQLCode(c.Id)})}})},onCenterTabChange:function(b,a){if("query" in a){workspaceQueries.current=a.query;workspaceQueries.propertyData.setSource(a.propertySource);workspaceQueries.gridColumns.unbindStore();workspaceQueries.gridColumns.bindStore(a.columnSource);workspaceQueries.gridResults.reconfigure(null,a.coldata)}},itemQueries:Ext.create("Ext.tree.Panel",{title:"Requêtes",store:Ext.create("Ext.data.TreeStore",{model:"treeModel",proxy:{type:"memory"}}),viewConfig:{plugins:{ptype:"treeviewdragdrop"},listeners:{beforedrop:function(d,f,e,b,a,c){if((b=="before"||b=="after")&&e.parentNode.raw.text=="Root"){if(f.records[0].raw.nodek=="query"){a.cancelDrop()}}},drop:function(b,e,d,a){if(e.records[0].raw.nodek=="groupquery"){var f={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","group","query",f,function(g){})}else{if(e.records[0].raw.nodek=="query"){var c={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","query","query",c,function(g){if(workspaceQueries.current.Id==c.id){workspaceQueries.current.groupid=c.groupid}})}}}}},rootVisible:false,listeners:{afterrender:function(a,b){var c=new Ext.LoadMask(workspaceQueries.itemQueries,{msg:"Veuillez patienter ..."});c.show();symfony("list","query","query",{},function(d){var f=workspaceQueries.itemQueries.getStore();var e=f.setRootNode({children:d.data});Ext.apply(workspaceQueries.itemQueries,{store:f});c.hide()})},itemdblclick:function(c,f,e,d,a){if(f.get("leaf")){var b=new Ext.LoadMask(centerPanel,{msg:"Chargement en cours ..."});b.show();symfony("get","query","query",{id:f.raw.Id},function(g){f.raw=g.data;workspaceQueries.gotoQuery(f);b.hide()})}},containercontextmenu:function(b,a){workspaceQueries.menuGroupQueries.rec=workspaceQueries.itemQueries.store.tree.root;workspaceQueries.menuRootGroupQueries.showAt(a.getXY());a.stopEvent()},itemcontextmenu:function(b,e,d,c,a){if(e.get("leaf")){workspaceQueries.menuQueries.rec=e;workspaceQueries.menuQueries.showAt(a.getXY())}else{workspaceQueries.menuGroupQueries.rec=e;workspaceQueries.menuGroupQueries.showAt(a.getXY())}a.stopEvent()}}}),setProperties:function(a){$.each(a,function(b,c){workspaceQueries.propertySource[b]=c});workspaceQueries.propertyData.setSource(workspaceQueries.propertySource)},set:function(a,b){currentWorkspace=workspaceQueries;bottomPanel.show();propertyPanel.removeAll();workspaceQueries.propertySource={"(name)":"name",alias:"alias",description:Ext.encode({description_resume:"",description_details:""}),motscles:"",datasourceid:"",publiee:true};symfony("list","datasrc","datasource",{},function(d){var e=[];$.each(d.data,function(f,g){e.push(g)});var c=Ext.create("Ext.data.Store",{fields:["Id","title"],data:e});workspaceQueries.setAfterLoad(a,c,b)})},setAfterLoad:function(b,a,c){workspaceQueries.currentTab=b.tab;workspaceQueries.propertyData=Ext.create("Ext.grid.property.Grid",{title:"Propriétés",propertyNames:{"(name)":"(Nom)",alias:"Alias",description:"Description",motscles:"Mots clés",datasourceid:"Source de données",publiee:"Publiée"},sourceConfig:{datasourceid:{renderer:function(d){a.data.each(function(g,e,f){if(g.raw.Id==d){d=g.raw.title}});return d}}},listeners:{propertychange:function(i,f,h,e){var g=centerPanel.getActiveTab();var d=h;if(f=="(name)"){d=replaceAll(" ","_",h)}if(f=="(name)"&&g.rec.raw.alias.trim()===""){g.rec.set("text",d);g.rec.raw.text=d;g.rec.raw.title=d;g.rec.commit();g.setTitle(h)}if(f=="alias"&&h.trim()!==""){g.rec.set("text",h);g.rec.raw.text=h;g.rec.raw.alias=h;g.rec.commit();g.setTitle(h)}}},customEditors:{description:{xtype:"descriptionfield"},groupe:{xtype:"combobox"},datasourceid:Ext.create("Ext.form.ComboBox",{store:a,queryMode:"local",displayField:"title",valueField:"Id",emptyText:"(Aucun)"})},customRenderers:{"(name)":function(d){return replaceAll(" ","_",d)},description:function(d){var g=Ext.decode(d),h=g.description_details,e=g.description_resume,f="";f+="<b>"+e+"</b>: ";f+="<i>"+h+"</i>";return f},publiee:function(d){if(d){return"Oui"}else{return"Non"}}},source:workspaceQueries.propertySource});propertyPanel.add(workspaceQueries.propertyData);workspaceQueries.propertyData.columns[0].width=150;propertyPanel.add(Ext.create("Ext.Panel",{title:"Historique",items:[]}));propertyPanel.add(aboutTab());propertyPanel.setActiveTab(workspaceQueries.propertyData);workspaceQueries.gridColumns=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1,dataIndex:"ordre"},{text:"Table",flex:1,sortable:1,dataIndex:"table"},{text:"Nom SQL",flex:1,sortable:1,dataIndex:"name"},{text:"Titre de la colonne",flex:1,sortable:1,dataIndex:"displayed",editor:"textfield"},{text:"Afficher",flex:1,sortable:1,dataIndex:"printed",editor:{xtype:"combobox",forceSelection:true,editable:false,triggerAction:"all",allowBlank:false,valueField:"value",displayField:"descr",store:Ext.create("Ext.data.Store",{fields:["descr","value"],data:[{descr:"Oui",value:true},{descr:"Non",value:false}]})},renderer:function(f,e,d){switch(f){case false:return"Non";case true:return"Oui"}}},{text:"Type",flex:1,sortable:1,dataIndex:"type",renderer:function(f,e,d){switch(f){case"STRING":return"Chaîne";case"INTEGER":return"Entier";case"DATE":return"Date";case"LONG":return"Entier long";case"TINY":return"Booléen";case"VAR_STRING":return"Chaîne";case"TEXT":return"Texte"}return f}},{text:"Longueur",flex:1,sortable:1,dataIndex:"len"},{text:"Précision",flex:1,sortable:1,dataIndex:"precision"}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],listeners:{edit:function(f,g){if(g.field=="displayed"){g.record.raw.displayed=g.value}if(g.field=="printed"){g.record.raw.printed=g.value}var d={id:g.record.raw.Id,displayed:g.record.raw.displayed,printed:g.record.raw.printed};symfony("save","column","query",d,function(e){g.record.commit()})}}});workspaceQueries.gridResults=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1}]});workspaceQueries.gridVars=Ext.create("Ext.grid.Panel",{columnLines:true,selType:"checkboxmodel",selModel:{mode:"MULTI"},viewConfig:{stripeRows:true},columns:[{text:"Id",dataIndex:"Id",hidden:true},{text:"Nom",dataIndex:"name",flex:1,sortable:1,editor:{allowBlank:false}},{text:"Libellé",dataIndex:"title",flex:1,sortable:1,editor:{allowBlank:true}},{text:"Type",dataIndex:"type",flex:1,sortable:1,editor:{xtype:"combobox",forceSelection:true,editable:false,triggerAction:"all",allowBlank:false,valueField:"value",displayField:"descr",store:Ext.create("Ext.data.Store",{fields:["descr","value"],data:[{descr:"Chaîne",value:"STRING"},{descr:"Entier",value:"INTEGER"},{descr:"Date",value:"DATE"},{descr:"Booléen",value:"BOOLEAN"}]})},renderer:function(f,e,d){switch(f){case"STRING":return"Chaîne";case"INTEGER":return"Entier";case"DATE":return"Date";case"BOOLEAN":return"Booléen"}}},{text:"Valeur initiale",dataIndex:"value",flex:1,sortable:1,editor:{allowBlank:true}}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],listeners:{edit:function(d,f){if(f.field=="name"){f.record.raw.name=f.value}if(f.field=="title"){f.record.raw.title=f.value}if(f.field=="type"){f.record.raw.type=f.value}if(f.field=="value"){f.record.raw.value=f.value}}}});bottomPanel.removeAll();workspaceQueries.parametreColonnes=Ext.create("Ext.Panel",{title:"Paramètres d'affichage des colonnes",iconCls:"tabs",closable:false,items:[workspaceQueries.gridColumns]});workspaceQueries.resultatsRequetes=Ext.create("Ext.Panel",{title:"Résultats requetes",iconCls:"tabs",closable:false,items:[workspaceQueries.gridResults],tbar:[{text:"Extraire",iconCls:"icon-export",key:"csv",handler:workspaceQueries.resulttask}]});workspaceQueries.variablesRequetes=Ext.create("Ext.Panel",{title:"Variables",iconCls:"tabs",closable:false,items:[workspaceQueries.gridVars],tbar:[{text:"Ajouter",iconCls:"icon-add",key:"add",handler:workspaceQueries.vartask},{text:"Recharger",iconCls:"icon-refresh",key:"load",handler:workspaceQueries.vartask},{text:"Enregistrer",iconCls:"icon-save",key:"save",handler:workspaceQueries.vartask},{text:"Supprimer",iconCls:"icon-delete",key:"delete",handler:workspaceQueries.vartask}]});workspaceQueries.variablesRequetes.Mask=new Ext.LoadMask(workspaceQueries.variablesRequetes,{msg:"Veuillez patienter ..."});if(workspaceQueries.currentTab.storeVariables!==undefined){workspaceQueries.gridVars.getView().bindStore(workspaceQueries.currentTab.storeVariables)}else{symfony("list","variable","query",{id:workspaceQueries.currentTab.rec.raw.Id},function(d){var e=[];$.each(d.data,function(f,g){e.push(g)});workspaceQueries.currentTab.storeVariables=Ext.create("Ext.data.Store",{fields:["Id","name","title","type","value"],data:e});workspaceQueries.gridVars.getView().bindStore(workspaceQueries.currentTab.storeVariables)})}bottomPanel.add(workspaceQueries.variablesRequetes);bottomPanel.add(workspaceQueries.parametreColonnes);bottomPanel.add(workspaceQueries.resultatsRequetes);bottomPanel.setActiveTab(workspaceQueries.variablesRequetes);c()},getQuery:function(b,a){symfony("get","query","query",{id:b},function(c){if(workspaceQueries.queries[c.data.Id]===undefined){workspaceQueries.queries[c.data.Id]={}}workspaceQueries.queries[c.data.Id]={};a(c.data)})},saveCurrent:function(d){var b=workspaceQueries.queries[workspaceQueries.current.Id].editor.getValue();workspaceQueries.current.content=b;workspaceQueries.current.title=replaceAll(" ","_",workspaceQueries.propertyData.source["(name)"]);workspaceQueries.current.alias=workspaceQueries.propertyData.source.alias;workspaceQueries.current.description=workspaceQueries.propertyData.source.description;workspaceQueries.current.motscles=workspaceQueries.propertyData.source.motscles;workspaceQueries.current.datasourceid=workspaceQueries.propertyData.source.datasourceid;workspaceQueries.current.publiee=workspaceQueries.propertyData.source.publiee;var c={id:workspaceQueries.current.Id,title:workspaceQueries.current.title,alias:workspaceQueries.current.alias,content:workspaceQueries.current.content,groupid:workspaceQueries.current.groupid,description:workspaceQueries.current.description,motscles:workspaceQueries.current.motscles,datasourceid:workspaceQueries.current.datasourceid,publiee:workspaceQueries.current.publiee};var a=new Ext.LoadMask(centerPanel,{msg:"Sauvegarde en cours ..."});a.show();symfony("save","query","query",c,function(e){if(d!==undefined){d(e.data)}a.hide()})},analyseCurrent:function(d){function b(e){workspaceQueries.saveCurrent(function(f){var g={id:f.Id,variables:e};symfony("analyse","query","query",g,function(h){var k=[];var j=[];$.each(h.data,function(l,m){k.push(m);if(m.printed){j.push(m)}});var i=Ext.create("Ext.data.Store",{fields:["Id","type","table","name","len","precision","ordre","displayed","printed","width"],data:k});workspaceQueries.gridColumns.unbindStore();workspaceQueries.gridColumns.bindStore(i);workspaceQueries.gridResults.reconfigure(null,j);if(d!==undefined){d(h.data,e)}})})}if(workspaceQueries.currentTab.storeVariables.data.items.length){var a=Ext.create("Ext.form.Panel",{renderTo:Ext.getBody(),id:"variableform",cls:"my-form-class",defaults:{labelWidth:150},floating:true,closable:true,modal:true,frame:true,title:"Valeurs des variables",bodyStyle:"padding: 10px 10px 0 10px;",items:[],buttons:[{text:"OK",formBind:true,handler:function(){b(a.getValues());a.close()}},{text:"Annuler",handler:function(){a.close()}}]});function c(e,f){e.xtype="textfield";switch(f){case"DATE":e.xtype="datefield";e.format="d/m/Y";break;case"BOOLEAN":e.xtype="combobox";e.forceSelection=true;e.editable=false;e.triggerAction="all";e.valueField="value";e.displayField="descr";e.store=Ext.create("Ext.data.Store",{fields:["descr","value"],data:[{descr:"Vrai",value:1},{descr:"Faux",value:0}]});e.renderer=function(i,h,g){switch(i){case 1:return"Vrai";case 0:return"Faux"}};break}return e}$.each(workspaceQueries.currentTab.storeVariables.data.items,function(e,f){var g={xtype:c(f.raw.type),fieldLabel:f.raw.title,name:f.raw.name,allowBlank:false,value:f.raw.value};g=c(g,f.raw.type);a.add(g)});a.show()}else{b([])}},saveVariables:function(d,b){if(b>=d.length){workspaceQueries.variablesRequetes.Mask.hide();return}var c=d[b];var a={id:c.raw.Id,name:c.raw.name,title:c.raw.title,type:c.raw.type,value:c.raw.value,queryid:workspaceQueries.currentTab.rec.raw.Id};symfony("save","variable","query",a,function(e){c.raw.Id=e.data.Id;c.commit();workspaceQueries.saveVariables(d,b+1)})},deleteVariables:function(d,b){if(b>=d.length){workspaceQueries.variablesRequetes.Mask.hide();return}var c=d[b];var a={id:c.raw.Id};symfony("delete","variable","query",a,function(e){workspaceQueries.currentTab.storeVariables.remove(c);workspaceQueries.deleteVariables(d,b+1)})},vartask:function(a){switch(a.key){case"save":var c=workspaceQueries.gridVars;var e=c.getSelectionModel().getSelection();if(e.length){workspaceQueries.variablesRequetes.Mask.show();workspaceQueries.saveVariables(e,0)}else{Ext.Msg.alert("Totem","Selectionnez les variables à enregistrer.")}break;case"add":var c=workspaceQueries.gridVars;var b=workspaceQueries.currentTab.storeVariables;var d=Ext.create("variableModel",{Id:0,name:"variable",title:"Variable",type:"STRING",value:""});b.insert(b.count(),d);c.editingPlugin.startEdit(d,1);break;case"load":workspaceQueries.variablesRequetes.Mask.show();symfony("list","variable","query",{id:workspaceQueries.currentTab.rec.raw.Id},function(f){var g=[];$.each(f.data,function(h,i){g.push(i)});workspaceQueries.currentTab.storeVariables=Ext.create("Ext.data.Store",{fields:["Id","name","title","type","value"],data:g});workspaceQueries.gridVars.getView().bindStore(workspaceQueries.currentTab.storeVariables);workspaceQueries.variablesRequetes.Mask.hide()});break;case"delete":var c=workspaceQueries.gridVars;var e=c.getSelectionModel().getSelection();if(e.length){workspaceQueries.variablesRequetes.Mask.show();workspaceQueries.deleteVariables(e,0)}else{Ext.Msg.alert("Totem","Selectionnez les variables à supprimer.")}break}},resulttask:function(b){switch(b.key){case"csv":var a=(window.location.href.indexOf("admin")>-1)?"./admin/":"./";window.location=a+"csv?id="+workspaceQueries.current.Id;break}},task:function(a){switch(a.key){case"save":workspaceQueries.saveCurrent();break;case"analyse":bottomPanel.setActiveTab(workspaceQueries.parametreColonnes);workspaceQueries.analyseCurrent();break;case"run":bottomPanel.setActiveTab(workspaceQueries.resultatsRequetes);workspaceQueries.analyseCurrent(function(b,d){var c={id:workspaceQueries.current.Id,variables:d};symfony("run","query","query",c,function(f){var e=[];$.each(b,function(i,j){if(j.printed){e.push(j.name)}});var g=[];$.each(f.data,function(i,j){g.push(j)});var h=Ext.create("Ext.data.Store",{fields:e,data:g});workspaceQueries.gridResults.unbindStore();workspaceQueries.gridResults.bindStore(h)})});break}}};
function parseHTMLCode(a){var b="text/html";workspaceReports.reports[a].editor=CodeMirror.fromTextArea(document.getElementById("codehtml"+a),{mode:b,indentWithTabs:true,smartIndent:true,lineNumbers:true,matchBrackets:true,autofocus:true,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{tables:{users:{name:null,score:null,birthDate:null},countries:{name:null,population:null,size:null}}}})}var clipboardReports=undefined;var workspaceReports={name:"reports",current:null,reports:[],propertyData:null,properySource:null,init:function(){Ext.define("treeModel",{extend:"Ext.data.Model",fields:[{name:"Id",type:"int"},{name:"title",type:"string"},{name:"nodek",type:"string"},{name:"text",type:"string"},{name:"groupid",type:"int"}]})},menuReports:new Ext.menu.Menu({items:[{text:"Modifier le rapport",key:"modreport"},{text:"Supprimer le rapport",key:"delreport"},{xtype:"menuseparator"},{text:"Copier",key:"copyreport"},{text:"Couper",key:"cutreport"}],listeners:{click:function(c,a){switch(a.key){case"modreport":workspaceReports.gotoReport(workspaceReports.menuReports.rec);break;case"delreport":var b=workspaceReports.menuReports.rec;Ext.MessageBox.show({title:"Totem : Suppression de rapport",msg:"Etes-vous certain de vouloir supprimer le rapport [ "+b.raw.title+" ] ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspaceReports.itemReports,{msg:"Suppression en cours ..."});e.show();symfony("delete","report","report",{id:b.raw.Id},function(g){b.remove(true);workspaceReports.autoCloseCenterTab();f.hide();e.hide()})}}});break;case"copyreport":workspaceReports.copy(workspaceReports.menuReports.rec);break;case"cutreport":workspaceReports.cut(workspaceReports.menuReports.rec);break}}}}),menuGroupReports:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{text:"Modifier ce groupe",key:"modgroup"},{text:"Supprimer ce groupe",key:"delgroup"},{xtype:"menuseparator"},{text:"Copier",key:"copygroup"},{text:"Couper",key:"cutgroup"},{id:"reportpaste",text:"Coller",key:"paste",disabled:true},{xtype:"menuseparator"},{text:"Ajouter un rapport",key:"addreport"},{text:"Générer un rapport",key:"wizardreport"}],listeners:{click:function(c,a){switch(a.key){case"copygroup":workspaceReports.copy(workspaceReports.menuGroupReports.rec);break;case"cutgroup":workspaceReports.cut(workspaceReports.menuGroupReports.rec);break;case"wizardreport":workspaceReports.wizardreport(workspaceReports.menuGroupReports.rec);break;case"addreport":workspaceReports.newReport(workspaceReports.menuGroupReports.rec);break;case"paste":workspaceReports.paste(workspaceReports.menuGroupReports.rec);break;case"addgroup":workspaceReports.groupForm.load("Nouveau groupe","new",workspaceReports.menuGroupReports.rec).show();break;case"modgroup":workspaceReports.groupForm.load("Modifier un groupe","update",workspaceReports.menuGroupReports.rec).show();break;case"delgroup":var b=workspaceReports.menuGroupReports.rec;Ext.MessageBox.show({title:"Totem : Suppression de groupe",msg:"Etes-vous certain de vouloir supprimer le groupe [ "+b.raw.title+" ] et tous les éléments qu'il contient ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspaceReports.itemReports,{msg:"Suppression en cours ..."});e.show();symfony("delete","group","report",{id:b.raw.Id},function(g){b.remove(true);workspaceReports.autoCloseCenterTab();f.hide();e.hide()})}}});break}}}}),wizardreport:function(a){var b=[];symfony("listall","query","query",{},function(c){b=c.data;var d=new Ext.form.Panel({defaults:{labelWidth:150},width:700,height:170,title:"Assistant de génération de rapport",floating:true,closable:true,modal:true,frame:true,bodyStyle:"padding: 10px 10px 0 10px; background-color:#dfeaf2",layout:{type:"vbox",align:"stretch"},items:[{id:"name",xtype:"textfield",fieldLabel:"Nom du rapport",allowBlank:false,name:"name"},{id:"query",anchor:"100%",fieldLabel:"Requête",xtype:"groupingcombobox",name:"query",allowBlank:false,groupField:["grouptree"],valueField:"Id",displayField:"text",displaySeparator:" ❱ ",queryMode:"local",editable:false,typeAhead:true,store:{fields:[{name:"Id",type:"int"},{name:"grouptree",type:"string"},{name:"text",type:"string"}],sorters:[{property:"grouptree",direction:"ASC"}],data:b}}],buttons:[{text:"Generer",formBind:true,handler:function(){var g=d.items.get("name").value;var e=d.items.get("query").getValue();var f={queryid:e,title:g,parentid:a.raw.Id};symfony("generate","report","report",f,function(h){a.appendChild(h.data);d.close()})}},{text:"Annuler",handler:function(){d.close()}}]});d.show()})},copy:function(a){clipboardReports={item:a,action:"copy"};Ext.getCmp("reportpaste").setDisabled(false);if(a.raw.nodek=="groupreport"){Ext.getCmp("reportpasteroot").setDisabled(false)}},cut:function(a){clipboardReports={item:a,action:"cut"};Ext.getCmp("reportpaste").setDisabled(false);if(a.raw.nodek=="groupreport"){Ext.getCmp("reportpasteroot").setDisabled(false)}},paste:function(d){var b=clipboardReports.item;if(clipboardReports.action=="cut"){if(clipboardReports.item.raw.nodek=="report"){var a={id:clipboardReports.item.raw.Id,groupid:d.raw.Id};symfony("save","report","report",a,function(e){if(workspaceReports.current!=null&&workspaceReports.current.Id==a.id){workspaceReports.current.groupid=a.groupid}d.appendChild(b)})}else{if(clipboardReports.item.raw.nodek=="groupreport"){var c={id:clipboardReports.item.raw.Id,groupid:d.raw.Id};symfony("save","group","report",c,function(e){d.appendChild(b)})}}}else{if(clipboardReports.item.raw.nodek=="report"){var a={id:clipboardReports.item.raw.Id,groupid:d.raw.Id};symfony("clone","report","report",a,function(e){d.appendChild(e.data)})}else{if(clipboardReports.item.raw.nodek=="groupreport"){var c={id:clipboardReports.item.raw.Id,groupid:d.raw.Id};symfony("clone","group","report",c,function(e){d.appendChild(e.data)})}}}clipboardReports=null;Ext.getCmp("reportpaste").setDisabled(true);Ext.getCmp("reportpasteroot").setDisabled(true)},menuRootGroupReports:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{xtype:"menuseparator"},{id:"reportpasteroot",text:"Coller",key:"paste",disabled:true}],listeners:{click:function(b,a){switch(a.key){case"addgroup":workspaceReports.groupForm.load("Nouveau groupe","new",workspaceReports.menuGroupReports.rec).show();break;case"paste":workspaceReports.paste(workspaceReports.menuGroupReports.rec);break}}}}),groupForm:{load:function(f,c,e){var d=null;var b=null;if(c=="new"){d={raw:{Id:0,title:"",text:""}};b=e}if(c=="update"){d=e;b=e.parentNode}var a=new Ext.form.Panel({defaults:{labelWidth:150},width:500,height:400,title:f,floating:true,closable:true,modal:true,frame:true,bodyStyle:"padding: 10px 10px 0 10px; background-color:#dfeaf2",layout:{type:"vbox",align:"stretch"},items:[{id:"name",xtype:"textfield",fieldLabel:"Name",name:"name",value:d.raw.title},{xtype:"displayfield",fieldLabel:"Parent",name:"parent",value:(b.raw.Id==0||b.raw.Id==null)?"(Racine)":b.raw.title},{xtype:"tabpanel",flex:1,frame:true,bodyStyle:"padding: 10px 10px 0 10px;",items:[{title:"Info",items:[{xtype:"textfield",fieldLabel:"Country",name:"country"}]},{title:"Contact",items:[{xtype:"textfield",fieldLabel:"Email",name:"email"}]}]}],buttons:[{text:"Enregistrer",handler:function(){var h=a.items.get("name").value;var g=(b.raw.Id)?b.raw.Id:0;group={id:d.raw.Id,title:h,groupid:g};symfony("save","group","report",group,function(i){if(c=="new"){b.insertChild(-1,{Id:i.data.Id,title:group.title,text:group.title});if(!b.isExpanded()){b.expand()}}if(c=="update"){d.set("text",group.title);d.raw.text=group.title;d.raw.title=group.title;d.commit()}a.close()})}},{text:"Annuler",handler:function(){a.close()}}]});return a}},autoCloseCenterTab:function(){centerPanel.items.each(function(c,b,d){if("report" in c&&c.report.Id!=0){var a={id:c.report.Id};symfony("exists","report","report",a,function(e){if(e.data.response=="false"){if(workspaceReports.current.Id==a.id){workspaceReports.current=null}centerPanel.remove(c)}})}})},newReport:function(b){var a={groupid:b.raw.Id,title:"Nouveau rapport",content:"<html>\n\t<body>\n\t\tContenu du rapport\n\t</body>\n</html>"};symfony("save","report","report",a,function(c){var d=b.insertChild(-1,c.data);workspaceReports.gotoReport(d)})},gotoReport:function(a){workspaceReports.getReport(a.raw.Id,function(b){var c=false;centerPanel.items.each(function(f,e,g){if(f.report&&b.Id==f.report.Id){c=true;centerPanel.setActiveTab(f)}});if(!c){var d=Ext.create("Ext.Panel",{title:a.raw.text,iconCls:"icon-report",html:"<textarea id='codehtml"+b.Id+"' name='codehtml'>"+b.content+"</textarea>",closable:true,active:true,tbar:[{text:"Enregistrer",key:"save",handler:workspaceReports.task},{text:"Aperçu",key:"apercu",handler:workspaceReports.task},{text:"Exécuter",key:"run",handler:workspaceReports.task}]});d.report=a.raw;d.rec=a;d.workspace=workspaceReports;d.propertySource={"(name)":b.title,description:Ext.encode({description_resume:"",description_details:""}),motscles:"",environnement:"",nodek:"",publiee:true};centerPanel.add(d);centerPanel.setActiveTab(d);parseHTMLCode(b.Id)}})},onCenterTabChange:function(b,a){if("report" in a){workspaceReports.current=a.report;workspaceReports.propertyData.setSource(a.propertySource)}},itemReports:Ext.create("Ext.tree.Panel",{title:"Rapports",store:Ext.create("Ext.data.TreeStore",{model:"treeModel",proxy:{type:"memory"}}),viewConfig:{plugins:{ptype:"treeviewdragdrop"},listeners:{beforedrop:function(d,f,e,b,a,c){if((b=="before"||b=="after")&&e.parentNode.raw.text=="Root"){if(f.records[0].raw.nodek=="report"){a.cancelDrop()}}},drop:function(c,e,d,b){if(e.records[0].raw.nodek=="groupreport"){var f={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","group","report",f,function(g){})}else{if(e.records[0].raw.nodek=="report"){var a={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","report","report",a,function(g){if(workspaceReports.current.Id==a.id){workspaceReports.current.groupid=a.groupid}})}}}}},rootVisible:false,listeners:{afterrender:function(a,b){var c=new Ext.LoadMask(workspaceReports.itemReports,{msg:"Veuillez patienter ..."});c.show();symfony("list","report","report",{},function(d){var f=workspaceReports.itemReports.getStore();var e=f.setRootNode({children:d.data});Ext.apply(workspaceReports.itemReports,{store:f});c.hide()})},itemdblclick:function(c,f,e,d,a){if(f.get("leaf")){var b=new Ext.LoadMask(centerPanel,{msg:"Chargement en cours ..."});b.show();symfony("get","report","report",{id:f.raw.Id},function(g){f.raw=g.data;workspaceReports.gotoReport(f);b.hide()})}},containercontextmenu:function(b,a){workspaceReports.menuGroupReports.rec=workspaceReports.itemReports.store.tree.root;workspaceReports.menuRootGroupReports.showAt(a.getXY());a.stopEvent()},itemcontextmenu:function(b,e,d,c,a){if(e.get("leaf")){workspaceReports.menuReports.rec=e;workspaceReports.menuReports.showAt(a.getXY())}else{workspaceReports.menuGroupReports.rec=e;workspaceReports.menuGroupReports.showAt(a.getXY())}a.stopEvent()}}}),setProperties:function(a){$.each(a,function(b,c){workspaceReports.propertySource[b]=c});workspaceReports.propertyData.setSource(workspaceReports.propertySource)},set:function(b,d){currentWorkspace=workspaceReports;bottomPanel.show();propertyPanel.removeAll();workspaceReports.propertySource={"(name)":"name",description:Ext.encode({description_resume:"",description_details:""}),motscles:"",environnement:"",nodek:"",publiee:true};workspaceReports.propertyData=Ext.create("Ext.grid.property.Grid",{title:"Propriétés",propertyNames:{"(name)":"(Nom)",description:"Description",motscles:"Mots clés",environnement:"Environnement",nodek:"Groupe",publiee:"Publiée"},listeners:{propertychange:function(k,h,j,g){if(h=="(name)"){var i=centerPanel.getActiveTab();i.rec.set("text",j);i.rec.raw.text=j;i.rec.raw.title=j;i.rec.commit();i.setTitle(j)}}},customEditors:{description:{xtype:"descriptionfield"},groupe:{xtype:"combobox"},environnement:{xtype:"combobox"}},customRenderers:{description:function(g){var j=Ext.decode(g),k=j.description_details,h=j.description_resume,i="";i+="<b>"+h+"</b>: ";i+="<i>"+k+"</i>";return i}},source:workspaceReports.propertySource});propertyPanel.add(workspaceReports.propertyData);propertyPanel.add(aboutTab());propertyPanel.setActiveTab(workspaceReports.propertyData);var f=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1},{text:"Titre de la colonne",flex:1,sortable:1},{text:"Cadrage",flex:1,sortable:1},{text:"Format de date",flex:1,sortable:1},{text:"Largeur de la colonne",flex:1,sortable:1}]});var e=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1}]});bottomPanel.removeAll();var c=Ext.create("Ext.Panel",{title:"Paramètres d'affichage des colonnes",iconCls:"tabs",closable:false,items:[f]});var a=Ext.create("Ext.Panel",{title:"Résultats rapports",iconCls:"tabs",html:"center south",closable:false,items:[e]});bottomPanel.add(c);bottomPanel.add(a);bottomPanel.setActiveTab(c);d()},getReport:function(b,a){symfony("get","report","report",{id:b},function(c){if(workspaceReports.reports[c.data.Id]===undefined){workspaceReports.reports[c.data.Id]={}}a(c.data)})},task:function(d){switch(d.key){case"save":var f=workspaceReports.reports[workspaceReports.current.Id].editor.getValue();workspaceReports.current.content=f;var g=workspaceReports.propertyData.source["(name)"];workspaceReports.current.title=g;var b={id:workspaceReports.current.Id,title:workspaceReports.current.title,content:workspaceReports.current.content,groupid:workspaceReports.current.groupid};var a=new Ext.LoadMask(centerPanel,{msg:"Sauvegarde en cours ..."});a.show();symfony("save","report","report",b,function(h){a.hide()});break;case"apercu":var e=new Ext.form.Panel({defaults:{labelWidth:150},width:800,height:600,title:"Aperçu du rapport",floating:true,closable:true,modal:true,frame:true,bodyStyle:"padding: 10px 10px 0 10px;",layout:{type:"vbox",align:"stretch"},html:"",buttons:[{text:"Imprimer",handler:function(){var h=(window.location.href.indexOf("admin")>-1)?"./admin/":"./";window.location=h+"report?id="+workspaceReports.current.Id}},{text:"Fermer",handler:function(){e.close()}}]});e.show();var a=new Ext.LoadMask(e,{msg:"Chargement en cours ..."});a.show();var b={id:workspaceReports.current.Id};symfony("run","report","report",b,function(h){e.update(h.data.html);a.hide()});break;case"run":var c=(window.location.href.indexOf("admin")>-1)?"./admin/":"./";window.location=c+"report?id="+workspaceReports.current.Id;break}}};
var clipboardSettings=undefined;var workspaceSettings={name:"settings",current:null,settings:[],propertyData:null,properySource:null,init:function(){Ext.define("treeModel",{extend:"Ext.data.Model",fields:[{name:"Id",type:"int"},{name:"title",type:"string"},{name:"nodek",type:"string"},{name:"text",type:"string"},{name:"groupid",type:"int"}]})},menuSettings:new Ext.menu.Menu({items:[{text:"Modifier la configuration",key:"modsetting"},{text:"Supprimer la configuration",key:"delsetting"},{xtype:"menuseparator"},{text:"Copier",key:"copysetting"},{text:"Couper",key:"cutsetting"}],listeners:{click:function(c,a){switch(a.key){case"modsetting":workspaceSettings.gotoSetting(workspaceSettings.menuSettings.rec);break;case"delsetting":var b=workspaceSettings.menuSettings.rec;Ext.MessageBox.show({title:"Totem : Suppression de configuration",msg:"Etes-vous certain de vouloir supprimer la configuration [ "+b.raw.title+" ] ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspaceSettings.itemSettings,{msg:"Suppression en cours ..."});e.show();symfony("delete","setting","setting",{id:b.raw.Id},function(g){b.remove(true);workspaceSettings.autoCloseCenterTab();f.hide();e.hide()})}}});break;case"copysetting":workspaceSettings.copy(workspaceSettings.menuSettings.rec);break;case"cutsetting":workspaceSettings.cut(workspaceSettings.menuSettings.rec);break}}}}),menuGroupSettings:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{text:"Modifier ce groupe",key:"modgroup"},{text:"Supprimer ce groupe",key:"delgroup"},{xtype:"menuseparator"},{text:"Copier",key:"copygroup"},{text:"Couper",key:"cutgroup"},{id:"settingpaste",text:"Coller",key:"paste",disabled:true},{xtype:"menuseparator"},{text:"Ajouter une configuration",key:"addsetting"}],listeners:{click:function(c,a){switch(a.key){case"copygroup":workspaceSettings.copy(workspaceSettings.menuGroupSettings.rec);break;case"cutgroup":workspaceSettings.cut(workspaceSettings.menuGroupSettings.rec);break;case"addsetting":workspaceSettings.newSetting(workspaceSettings.menuGroupSettings.rec);break;case"paste":workspaceSettings.paste(workspaceSettings.menuGroupSettings.rec);break;case"addgroup":workspaceSettings.groupForm.load("Nouveau groupe","new",workspaceSettings.menuGroupSettings.rec).show();break;case"modgroup":workspaceSettings.groupForm.load("Modifier un groupe","update",workspaceSettings.menuGroupSettings.rec).show();break;case"delgroup":var b=workspaceSettings.menuGroupSettings.rec;Ext.MessageBox.show({title:"Totem : Suppression de groupe",msg:"Etes-vous certain de vouloir supprimer le groupe [ "+b.raw.title+" ] et tous les éléments qu'il contient ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspaceSettings.itemSettings,{msg:"Suppression en cours ..."});e.show();symfony("delete","group","setting",{id:b.raw.Id},function(g){b.remove(true);workspaceSettings.autoCloseCenterTab();f.hide();e.hide()})}}});break}}}}),copy:function(a){clipboardSettings={item:a,action:"copy"};Ext.getCmp("settingpaste").setDisabled(false);if(a.raw.nodek=="groupsetting"){Ext.getCmp("settingpasteroot").setDisabled(false)}},cut:function(a){clipboardSettings={item:a,action:"cut"};Ext.getCmp("settingpaste").setDisabled(false);if(a.raw.nodek=="groupsetting"){Ext.getCmp("settingpasteroot").setDisabled(false)}},paste:function(d){var b=clipboardSettings.item;if(clipboardSettings.action=="cut"){if(clipboardSettings.item.raw.nodek=="setting"){var a={id:clipboardSettings.item.raw.Id,groupid:d.raw.Id};symfony("save","setting","setting",a,function(e){if(workspaceSettings.current!=null&&workspaceSettings.current.Id==a.id){workspaceSettings.current.groupid=a.groupid}d.appendChild(b)})}else{if(clipboardSettings.item.raw.nodek=="groupsetting"){var c={id:clipboardSettings.item.raw.Id,groupid:d.raw.Id};symfony("save","group","setting",c,function(e){d.appendChild(b)})}}}else{if(clipboardSettings.item.raw.nodek=="setting"){var a={id:clipboardSettings.item.raw.Id,groupid:d.raw.Id};symfony("clone","setting","setting",a,function(e){d.appendChild(e.data)})}else{if(clipboardSettings.item.raw.nodek=="groupsetting"){var c={id:clipboardSettings.item.raw.Id,groupid:d.raw.Id};symfony("clone","group","setting",c,function(e){d.appendChild(e.data)})}}}clipboardSettings=null;Ext.getCmp("settingpaste").setDisabled(true);Ext.getCmp("settingpasteroot").setDisabled(true)},menuRootGroupSettings:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{xtype:"menuseparator"},{id:"settingpasteroot",text:"Coller",key:"paste",disabled:true}],listeners:{click:function(b,a){switch(a.key){case"addgroup":workspaceSettings.groupForm.load("Nouveau groupe","new",workspaceSettings.menuGroupSettings.rec).show();break;case"paste":workspaceSettings.paste(workspaceSettings.menuGroupSettings.rec);break}}}}),groupForm:{load:function(f,c,e){var d=null;var b=null;if(c=="new"){d={raw:{Id:0,title:"",text:""}};b=e}if(c=="update"){d=e;b=e.parentNode}var a=new Ext.form.Panel({defaults:{labelWidth:150},width:500,height:400,title:f,floating:true,closable:true,modal:true,frame:true,bodyStyle:"padding: 10px 10px 0 10px; background-color:#dfeaf2",layout:{type:"vbox",align:"stretch"},items:[{id:"name",xtype:"textfield",fieldLabel:"Name",name:"name",value:d.raw.title},{xtype:"displayfield",fieldLabel:"Parent",name:"parent",value:(b.raw.Id==0||b.raw.Id==null)?"(Racine)":b.raw.title},{xtype:"tabpanel",flex:1,frame:true,bodyStyle:"padding: 10px 10px 0 10px;",items:[{title:"Info",items:[{xtype:"textfield",fieldLabel:"Country",name:"country"}]},{title:"Contact",items:[{xtype:"textfield",fieldLabel:"Email",name:"email"}]}]}],buttons:[{text:"Enregistrer",handler:function(){var h=a.items.get("name").value;var g=(b.raw.Id)?b.raw.Id:0;group={id:d.raw.Id,title:h,groupid:g};symfony("save","group","setting",group,function(i){if(c=="new"){b.insertChild(-1,{Id:i.data.Id,title:group.title,text:group.title});if(!b.isExpanded()){b.expand()}}if(c=="update"){d.set("text",group.title);d.raw.text=group.title;d.raw.title=group.title;d.commit()}a.close()})}},{text:"Annuler",handler:function(){a.close()}}]});return a}},autoCloseCenterTab:function(){centerPanel.items.each(function(c,a,d){if("setting" in c&&c.setting.Id!=0){var b={id:c.setting.Id};symfony("exists","setting","setting",b,function(e){if(e.data.response=="false"){if(workspaceSettings.current.Id==b.id){workspaceSettings.current=null}centerPanel.remove(c)}})}})},newSetting:function(b){var a={groupid:b.raw.Id,title:"Nouvelle configuration"};symfony("save","setting","setting",a,function(c){var d=b.insertChild(-1,c.data);workspaceSettings.gotoSetting(d)})},gotoSetting:function(a){workspaceSettings.getSetting(a.raw.Id,function(c){var b=false;centerPanel.items.each(function(f,e,g){if(f.setting&&c.Id==f.setting.Id){b=true;centerPanel.setActiveTab(f)}});if(!b){var d=Ext.create("Ext.Panel",{title:a.raw.text,iconCls:"icon-setting",html:"contenu",closable:true,active:true,tbar:[{text:"Enregistrer",key:"save",handler:workspaceSettings.task},{text:"Analyser",key:"analyse",handler:workspaceSettings.task},{text:"Exécuter",key:"run",handler:workspaceSettings.task}]});d.setting=a.raw;d.rec=a;d.workspace=workspaceSettings;d.propertySource={"(name)":c.title,description:Ext.encode({description_resume:"",description_details:""}),motscles:"",environnement:"",nodek:"",publiee:true};centerPanel.add(d);centerPanel.setActiveTab(d)}})},onCenterTabChange:function(b,a){if("setting" in a){workspaceSettings.current=a.setting;workspaceSettings.propertyData.setSource(a.propertySource)}},itemSettings:Ext.create("Ext.tree.Panel",{title:"Configurations",store:Ext.create("Ext.data.TreeStore",{model:"treeModel",proxy:{type:"memory"}}),viewConfig:{plugins:{ptype:"treeviewdragdrop"},listeners:{beforedrop:function(d,f,e,b,a,c){if((b=="before"||b=="after")&&e.parentNode.raw.text=="Root"){if(f.records[0].raw.nodek=="setting"){a.cancelDrop()}}},drop:function(c,e,d,a){if(e.records[0].raw.nodek=="groupsetting"){var f={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","group","setting",f,function(g){})}else{if(e.records[0].raw.nodek=="setting"){var b={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","setting","setting",b,function(g){if(workspaceSettings.current.Id==b.id){workspaceSettings.current.groupid=b.groupid}})}}}}},rootVisible:false,listeners:{afterrender:function(a,b){var c=new Ext.LoadMask(workspaceSettings.itemSettings,{msg:"Veuillez patienter ..."});c.show();symfony("list","setting","setting",{},function(d){var f=workspaceSettings.itemSettings.getStore();var e=f.setRootNode({children:d.data});Ext.apply(workspaceSettings.itemSettings,{store:f});c.hide()})},itemdblclick:function(c,f,e,d,a){if(f.get("leaf")){var b=new Ext.LoadMask(centerPanel,{msg:"Chargement en cours ..."});b.show();symfony("get","setting","setting",{id:f.raw.Id},function(g){f.raw=g.data;workspaceSettings.gotoSetting(f);b.hide()})}},containercontextmenu:function(b,a){workspaceSettings.menuGroupSettings.rec=workspaceSettings.itemSettings.store.tree.root;workspaceSettings.menuRootGroupSettings.showAt(a.getXY());a.stopEvent()},itemcontextmenu:function(b,e,d,c,a){if(e.get("leaf")){workspaceSettings.menuSettings.rec=e;workspaceSettings.menuSettings.showAt(a.getXY())}else{workspaceSettings.menuGroupSettings.rec=e;workspaceSettings.menuGroupSettings.showAt(a.getXY())}a.stopEvent()}}}),setProperties:function(a){$.each(a,function(b,c){workspaceSettings.propertySource[b]=c});workspaceSettings.propertyData.setSource(workspaceSettings.propertySource)},set:function(b,d){currentWorkspace=workspaceSettings;bottomPanel.hide();propertyPanel.removeAll();workspaceSettings.propertySource={"(name)":"name",description:Ext.encode({description_resume:"",description_details:""}),motscles:"",environnement:"",nodek:"",publiee:true};workspaceSettings.propertyData=Ext.create("Ext.grid.property.Grid",{title:"Propriétés",propertyNames:{"(name)":"(Nom)",description:"Description",motscles:"Mots clés",environnement:"Environnement",nodek:"Groupe",publiee:"Publiée"},listeners:{propertychange:function(k,h,j,g){if(h=="(name)"){var i=centerPanel.getActiveTab();i.rec.set("text",j);i.rec.raw.text=j;i.rec.raw.title=j;i.rec.commit();i.setTitle(j)}}},customEditors:{description:{xtype:"descriptionfield"},groupe:{xtype:"combobox"},environnement:{xtype:"combobox"}},customRenderers:{description:function(g){var j=Ext.decode(g),k=j.description_details,h=j.description_resume,i="";i+="<b>"+h+"</b>: ";i+="<i>"+k+"</i>";return i}},source:workspaceSettings.propertySource});propertyPanel.add(workspaceSettings.propertyData);propertyPanel.add(aboutTab());propertyPanel.setActiveTab(workspaceSettings.propertyData);var f=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1},{text:"Titre de la colonne",flex:1,sortable:1},{text:"Cadrage",flex:1,sortable:1},{text:"Format de date",flex:1,sortable:1},{text:"Largeur de la colonne",flex:1,sortable:1}]});var e=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1}]});bottomPanel.removeAll();var c=Ext.create("Ext.Panel",{title:"Paramètres d'affichage des colonnes",iconCls:"tabs",closable:false,items:[f]});var a=Ext.create("Ext.Panel",{title:"Résultats configurations",iconCls:"tabs",html:"center south",closable:false,items:[e]});bottomPanel.add(c);bottomPanel.add(a);bottomPanel.setActiveTab(c);d()},getSetting:function(b,a){symfony("get","setting","setting",{id:b},function(c){if(workspaceSettings.settings[c.data.Id]===undefined){workspaceSettings.settings[c.data.Id]={}}a(c.data)})},task:function(b){switch(b.key){case"save":var d=workspaceSettings.propertyData.source["(name)"];workspaceSettings.current.title=d;var c={id:workspaceSettings.current.Id,title:workspaceSettings.current.title,groupid:workspaceSettings.current.groupid};var a=new Ext.LoadMask(centerPanel,{msg:"Sauvegarde en cours ..."});a.show();symfony("save","setting","setting",c,function(e){a.hide()});break}}};
var clipboardUsers=undefined;var workspaceUsers={name:"users",current:null,users:[],groups:[],propertyData:null,properySource:null,init:function(){Ext.require(["Ext.ux.form.field.ToggleSlide","Ext.ux.toggleslide.Thumb"]);Ext.define("treeModel",{extend:"Ext.data.Model",fields:[{name:"Id",type:"int"},{name:"title",type:"string"},{name:"nodek",type:"string"},{name:"text",type:"string"},{name:"color",type:"string"},{name:"persist",type:"boolean"},{name:"groupid",type:"int"}]})},menuUsers:new Ext.menu.Menu({items:[{text:"Modifier l'utilisateur",key:"moduser"},{text:"Supprimer l'utilisateur",key:"deluser"},{xtype:"menuseparator"},{text:"Copier",key:"copyuser"},{text:"Couper",key:"cutuser"}],listeners:{click:function(c,a){switch(a.key){case"moduser":workspaceUsers.gotoUser(workspaceUsers.menuUsers.rec);break;case"deluser":var b=workspaceUsers.menuUsers.rec;Ext.MessageBox.show({title:"Totem : Suppression d'utilisateur",msg:"Etes-vous certain de vouloir supprimer l'utilisateur [ "+b.raw.username+" ] ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspaceUsers.itemUsers,{msg:"Suppression en cours ..."});e.show();symfony("delete","user","user",{id:b.raw.Id},function(g){b.remove(true);workspaceUsers.autoCloseCenterTab();f.hide();e.hide()})}}});break;case"copyuser":workspaceUsers.copy(workspaceUsers.menuUsers.rec);break;case"cutuser":workspaceUsers.cut(workspaceUsers.menuUsers.rec);break}}}}),menuGroupUsers:new Ext.menu.Menu({items:[{text:"Modifier ce groupe",key:"modgroup"},{id:"userdelete",text:"Supprimer ce groupe",key:"delgroup"},{xtype:"menuseparator"},{text:"Copier",key:"copygroup"},{text:"Couper",key:"cutgroup"},{id:"userpaste",text:"Coller",key:"paste",disabled:true},{xtype:"menuseparator"},{text:"Ajouter un utilisateur",key:"adduser"},{xtype:"menuseparator"},{text:"Règles par défaut de ce groupe",key:"rulegroup"}],listeners:{click:function(c,a){switch(a.key){case"copygroup":workspaceUsers.copy(workspaceUsers.menuGroupUsers.rec);break;case"cutgroup":workspaceUsers.cut(workspaceUsers.menuGroupUsers.rec);break;case"adduser":workspaceUsers.newUser(workspaceUsers.menuGroupUsers.rec);break;case"rulegroup":workspaceUsers.rulesUserGroup(workspaceUsers.menuGroupUsers.rec);break;case"paste":workspaceUsers.paste(workspaceUsers.menuGroupUsers.rec);break;case"addgroup":workspaceUsers.groupForm.load("Nouveau groupe","new",workspaceUsers.menuGroupUsers.rec).show();break;case"modgroup":workspaceUsers.groupForm.load("Modifier un groupe","update",workspaceUsers.menuGroupUsers.rec).show();break;case"delgroup":var b=workspaceUsers.menuGroupUsers.rec;Ext.MessageBox.show({title:"Totem : Suppression de groupe",msg:"Etes-vous certain de vouloir supprimer le groupe [ "+b.raw.title+" ] et tous les éléments qu'il contient ?",width:400,buttons:Ext.MessageBox.YESNO,buttonText:{yes:"Oui",no:"Non"},fn:function(d){if(d=="yes"){var f=new Ext.LoadMask(centerPanel,{msg:"Suppression en cours ..."});f.show();var e=new Ext.LoadMask(workspaceUsers.itemUsers,{msg:"Suppression en cours ..."});e.show();symfony("delete","group","user",{id:b.raw.Id},function(g){b.remove(true);workspaceUsers.autoCloseCenterTab();f.hide();e.hide()})}}});break}}}}),copy:function(a){clipboardUsers={item:a,action:"copy"};Ext.getCmp("userpaste").setDisabled(false);if(a.raw.nodek=="groupuser"){Ext.getCmp("userpasteroot").setDisabled(false)}},cut:function(a){clipboardUsers={item:a,action:"cut"};Ext.getCmp("userpaste").setDisabled(false);if(a.raw.nodek=="groupuser"){Ext.getCmp("userpasteroot").setDisabled(false)}},paste:function(d){var b=clipboardUsers.item;if(clipboardUsers.action=="cut"){if(clipboardUsers.item.raw.nodek=="user"){var a={id:clipboardUsers.item.raw.Id,groupid:d.raw.Id};symfony("save","user","user",a,function(e){if(workspaceUsers.current!=null&&workspaceUsers.current.Id==a.id){workspaceUsers.current.groupid=a.groupid}d.appendChild(b)})}else{if(clipboardUsers.item.raw.nodek=="groupuser"){var c={id:clipboardUsers.item.raw.Id,groupid:d.raw.Id};symfony("save","group","user",c,function(e){d.appendChild(b)})}}}else{if(clipboardUsers.item.raw.nodek=="user"){var a={id:clipboardUsers.item.raw.Id,groupid:d.raw.Id};symfony("clone","user","user",a,function(e){d.appendChild(e.data)})}else{if(clipboardUsers.item.raw.nodek=="groupuser"){var c={id:clipboardUsers.item.raw.Id,groupid:d.raw.Id};symfony("clone","group","user",c,function(e){d.appendChild(e.data)})}}}clipboardUsers=null;Ext.getCmp("userpaste").setDisabled(true);Ext.getCmp("userpasteroot").setDisabled(true)},menuRootGroupUsers:new Ext.menu.Menu({items:[{text:"Ajouter un groupe",key:"addgroup"},{xtype:"menuseparator"},{id:"userpasteroot",text:"Coller",key:"paste",disabled:true}],listeners:{click:function(b,a){switch(a.key){case"addgroup":workspaceUsers.groupForm.load("Nouveau groupe","new",workspaceUsers.menuGroupUsers.rec).show();break;case"paste":workspaceUsers.paste(workspaceUsers.menuGroupUsers.rec);break}}}}),groupForm:{load:function(g,d,f){var e=null;var c=null;if(d=="new"){e={raw:{Id:0,title:"",text:"",color:"x-cal-27-ad"}};c=f}if(d=="update"){e=f;c=f.parentNode}var b=new Ext.form.Panel({defaults:{labelWidth:150},modal:true,bodyStyle:"padding: 10px 10px 0 10px; background-color:#dfeaf2",layout:{type:"vbox",align:"stretch"},items:[{id:"name",xtype:"textfield",fieldLabel:"Nom",name:"name",value:e.raw.title},{xtype:"displayfield",fieldLabel:"Parent",name:"parent",value:(c.raw.Id==0||c.raw.Id==null)?"(Racine)":c.raw.title},{xtype:"tabpanel",flex:1,frame:true,bodyStyle:"padding: 10px 10px 0 10px;",items:[{title:"Informations",id:"group_informations",items:[{xtype:"textfield",fieldLabel:"Country",name:"country"},{xtype:"ux_colorcombo",fieldLabel:"Code couleur",id:"codecouleur",name:"codecouleur",forceSelection:true,editable:false,triggerAction:"all",allowBlank:false,value:e.raw.color}]},{title:"Droits du groupe",items:[{xtype:"textfield",fieldLabel:"Email",name:"email"}]}]}],buttons:[{text:"Enregistrer",handler:function(){var j=b.items.get("name").value;var i=(c.raw.Id)?c.raw.Id:0;var h=Ext.getCmp("group_informations").items.get("codecouleur").value;group={id:e.raw.Id,title:j,groupid:i,color:h};symfony("save","group","user",group,function(k){if(d=="new"){c.insertChild(-1,{Id:k.data.Id,title:group.title,text:group.title,color:h});if(!c.isExpanded()){c.expand()}}if(d=="update"){e.set("text",group.title);e.raw.text=group.title;e.raw.title=group.title;e.raw.color=group.color;e.commit()}a.close()})}},{text:"Annuler",handler:function(){a.close()}}]});var a=Ext.create("Ext.Window",{title:g,height:null,width:500,closable:true,items:[b]});return a}},autoCloseCenterTab:function(){centerPanel.items.each(function(c,b,d){if("user" in c&&c.user.Id!=0){var a={id:c.user.Id};symfony("exists","user","user",a,function(e){if(e.data.response=="false"){if(workspaceUsers.current.Id==a.id){workspaceUsers.current=null}centerPanel.remove(c)}})}})},rulesUserGroup:function(a){workspaceUsers.gotoUserGroup(a)},newUser:function(b){var a={groupid:b.raw.Id,title:"Nouvel utilisateur"};symfony("save","user","user",a,function(c){var d=b.insertChild(-1,c.data);workspaceUsers.gotoUser(d)})},gotoUser:function(b){var a=new Ext.LoadMask(centerPanel,{msg:"Chargement en cours ..."});a.show();workspaceUsers.getUser(b.raw.Id,function(c){var d=false;centerPanel.items.each(function(g,f,h){if(g.user&&c.Id==g.user.Id){d=true;centerPanel.setActiveTab(g)}});if(!d){var e=Ext.create("Ext.Panel",{title:b.raw.text,iconCls:"icon-user",items:[{xtype:"panel",frame:true,title:"Accueil",bodyStyle:"padding: 10px;",style:"margin-bottom:10px;",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Afficher la page d'accueil",onText:"actif",offText:"inactif",name:"welcomeDisplay",id:"welcomeDisplayU"+c.Id,state:c.rules.welcomeDisplay},{xtype:"toggleslidefield",fieldLabel:"Afficher les états qui datent de plus de 5 jours",onText:"actif",offText:"inactif",name:"welcomeMoreFiveDays",id:"welcomeMoreFiveDaysU"+c.Id,state:c.rules.welcomeMoreFiveDays},{xtype:"toggleslidefield",fieldLabel:"Afficher le nombre de téléchargement",onText:"actif",offText:"inactif",name:"welcomeCountDownload",id:"welcomeCountDownloadU"+c.Id,state:c.rules.welcomeCountDownload}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Requêtes",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux requêtes",onText:"actif",offText:"inactif",name:"queryDisplay",id:"queryDisplayU"+c.Id,state:c.rules.queryDisplay},{xtype:"toggleslidefield",fieldLabel:"Créer des groupe de requêtes",onText:"actif",offText:"inactif",name:"queryGroupCreate",id:"queryGroupCreateU"+c.Id,state:c.rules.queryGroupCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des groupes de requêtes",onText:"actif",offText:"inactif",name:"queryGroupUpdate",id:"queryGroupUpdateU"+c.Id,state:c.rules.queryGroupUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des groupes de requêtes",onText:"actif",offText:"inactif",name:"queryGroupDelete",id:"queryGroupDeleteU"+c.Id,state:c.rules.queryGroupDelete},{xtype:"toggleslidefield",fieldLabel:"Créer des requêtes",onText:"actif",offText:"inactif",name:"queryCreate",id:"queryCreateU"+c.Id,state:c.rules.queryCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des requêtes",onText:"actif",offText:"inactif",name:"queryUpdate",id:"queryUpdateU"+c.Id,state:c.rules.queryUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des requêtes",onText:"actif",offText:"inactif",name:"queryDelete",id:"queryDeleteU"+c.Id,state:c.rules.queryDelete},{xtype:"toggleslidefield",fieldLabel:"Forcer l'affichage de toutes les requêtes",onText:"actif",offText:"inactif",name:"queryForceDisplay",id:"queryForceDisplayU"+c.Id,state:c.rules.queryForceDisplay},{xtype:"toggleslidefield",fieldLabel:"Exécution des requêtes",onText:"actif",offText:"inactif",name:"queryRun",id:"queryRunU"+c.Id,state:c.rules.queryRun},{xtype:"toggleslidefield",fieldLabel:"Extraire les requêtes CSV",onText:"actif",offText:"inactif",name:"queryExtractCSV",id:"queryExtractCSVU"+c.Id,state:c.rules.queryExtractCSV},{xtype:"toggleslidefield",fieldLabel:"Afficher les logs des requêtes",onText:"actif",offText:"inactif",name:"queryDisplayLog",id:"queryDisplayLogU"+c.Id,state:c.rules.queryDisplayLog}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Rapports",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux rapports",onText:"actif",offText:"inactif",name:"reportDisplay",id:"reportDisplayU"+c.Id,state:c.rules.reportDisplay},{xtype:"toggleslidefield",fieldLabel:"Créer des groupe de rapports",onText:"actif",offText:"inactif",name:"reportGroupCreate",id:"reportGroupCreateU"+c.Id,state:c.rules.reportGroupCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des groupes de rapports",onText:"actif",offText:"inactif",name:"reportGroupUpdate",id:"reportGroupUpdateU"+c.Id,state:c.rules.reportGroupUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des groupes de rapports",onText:"actif",offText:"inactif",name:"reportGroupDelete",id:"reportGroupDeleteU"+c.Id,state:c.rules.reportGroupDelete},{xtype:"toggleslidefield",fieldLabel:"Créer des rapports",onText:"actif",offText:"inactif",name:"reportCreate",id:"reportCreateU"+c.Id,state:c.rules.reportCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des rapports",onText:"actif",offText:"inactif",name:"reportUpdate",id:"reportUpdateU"+c.Id,state:c.rules.reportUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des rapports",onText:"actif",offText:"inactif",name:"reportDelete",id:"reportDeleteU"+c.Id,state:c.rules.reportDelete},{xtype:"toggleslidefield",fieldLabel:"Forcer l'affichage de toutes les rapports",onText:"actif",offText:"inactif",name:"reportForceDisplay",id:"reportForceDisplayU"+c.Id,state:c.rules.reportForceDisplay},{xtype:"toggleslidefield",fieldLabel:"Exécuter les rapports",onText:"actif",offText:"inactif",name:"reportRun",id:"reportRunU"+c.Id,state:c.rules.reportRun},{xtype:"toggleslidefield",fieldLabel:"Extraire les rapports PDF",onText:"actif",offText:"inactif",name:"reportExtractPDF",id:"reportExtractPDFU"+c.Id,state:c.rules.reportExtractPDF},{xtype:"toggleslidefield",fieldLabel:"Extraire les rapports Microsoft Word",onText:"actif",offText:"inactif",name:"reportExtractDOC",id:"reportExtractDOCU"+c.Id,state:c.rules.reportExtractDOC},{xtype:"toggleslidefield",fieldLabel:"Afficher les logs des rapports",onText:"actif",offText:"inactif",name:"reportDisplayLog",id:"reportDisplayLogU"+c.Id,state:c.rules.reportDisplayLog}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Tâches plannifiées",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux tâches plannifiée",onText:"actif",offText:"inactif",name:"planningDisplay",id:"planningDisplayU"+c.Id,state:c.rules.planningDisplay},{xtype:"toggleslidefield",fieldLabel:"Créer des groupe de tâches",onText:"actif",offText:"inactif",name:"planningGroupCreate",id:"planningGroupCreateU"+c.Id,state:c.rules.planningGroupCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des groupes de tâches",onText:"actif",offText:"inactif",name:"planningGroupUpdate",id:"planningGroupUpdateU"+c.Id,state:c.rules.planningGroupUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des groupes de tâches",onText:"actif",offText:"inactif",name:"planningGroupDelete",id:"planningGroupDeleteU"+c.Id,state:c.rules.planningGroupDelete},{xtype:"toggleslidefield",fieldLabel:"Créer des tâches",onText:"actif",offText:"inactif",name:"planningCreate",id:"planningCreateU"+c.Id,state:c.rules.planningCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des tâches",onText:"actif",offText:"inactif",name:"planningUpdate",id:"planningUpdateU"+c.Id,state:c.rules.planningUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des tâches",onText:"actif",offText:"inactif",name:"planningDelete",id:"planningDeleteU"+c.Id,state:c.rules.planningDelete},{xtype:"toggleslidefield",fieldLabel:"Forcer l'affichage de toutes les tâches",onText:"actif",offText:"inactif",name:"planningForceDisplay",id:"planningForceDisplayU"+c.Id,state:c.rules.planningForceDisplay},{xtype:"toggleslidefield",fieldLabel:"Afficher les logs des tâches",onText:"actif",offText:"inactif",name:"planningDisplayLog",id:"planningDisplayLogU"+c.Id,state:c.rules.planningDisplayLog}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Utilisateurs",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux utilisateurs",onText:"actif",offText:"inactif",name:"userDisplay",id:"userDisplayU"+c.Id,state:c.rules.userDisplay},{xtype:"toggleslidefield",fieldLabel:"Créer des groupe de utilisateurs",onText:"actif",offText:"inactif",name:"userGroupCreate",id:"userGroupCreateU"+c.Id,state:c.rules.userGroupCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des groupes de utilisateurs",onText:"actif",offText:"inactif",name:"userGroupUpdate",id:"userGroupUpdateU"+c.Id,state:c.rules.userGroupUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des groupes de utilisateurs",onText:"actif",offText:"inactif",name:"userGroupDelete",id:"userGroupDeleteU"+c.Id,state:c.rules.userGroupDelete},{xtype:"toggleslidefield",fieldLabel:"Créer des utilisateurs",onText:"actif",offText:"inactif",name:"userCreate",id:"userCreateU"+c.Id,state:c.rules.userCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des utilisateurs",onText:"actif",offText:"inactif",name:"userUpdate",id:"userUpdateU"+c.Id,state:c.rules.userUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des utilisateurs",onText:"actif",offText:"inactif",name:"userDelete",id:"userDeleteU"+c.Id,state:c.rules.userDelete},{xtype:"toggleslidefield",fieldLabel:"Forcer l'affichage de toutes les utilisateurs",onText:"actif",offText:"inactif",name:"userForceDisplay",id:"userForceDisplayU"+c.Id,state:c.rules.userForceDisplay},{xtype:"textfield",fieldLabel:"Durée de session inactive",name:"sessionInactiveDelay",id:"sessionInactiveDelayU"+c.Id,value:b.raw.rules.sessionInactiveDelay},{xtype:"toggleslidefield",fieldLabel:"Désactiver les utilisateurs",onText:"actif",offText:"inactif",name:"userEnabled",id:"userEnabledU"+c.Id,state:c.rules.userEnabled},{xtype:"toggleslidefield",fieldLabel:"Afficher les logs des utilisateurs",onText:"actif",offText:"inactif",name:"userDisplayLog",id:"userDisplayLogU"+c.Id,state:c.rules.userDisplayLog}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Sources de données",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux sources de données",onText:"actif",offText:"inactif",name:"datasourceDisplay",id:"datasourceDisplayU"+c.Id,state:c.rules.datasourceDisplay},{xtype:"toggleslidefield",fieldLabel:"Créer des groupe de sources de données",onText:"actif",offText:"inactif",name:"datasourceGroupCreate",id:"datasourceGroupCreateU"+c.Id,state:c.rules.datasourceGroupCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des groupes de sources de données",onText:"actif",offText:"inactif",name:"datasourceGroupUpdate",id:"datasourceGroupUpdateU"+c.Id,state:c.rules.datasourceGroupUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des groupes de sources de données",onText:"actif",offText:"inactif",name:"datasourceGroupDelete",id:"datasourceGroupDeleteU"+c.Id,state:c.rules.datasourceGroupDelete},{xtype:"toggleslidefield",fieldLabel:"Créer des sources de données",onText:"actif",offText:"inactif",name:"datasourceCreate",id:"datasourceCreateU"+c.Id,state:c.rules.datasourceCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des sources de données",onText:"actif",offText:"inactif",name:"datasourceUpdate",id:"datasourceUpdateU"+c.Id,state:c.rules.datasourceUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des sources de données",onText:"actif",offText:"inactif",name:"datasourceDelete",id:"datasourceDeleteU"+c.Id,state:c.rules.datasourceDelete},{xtype:"toggleslidefield",fieldLabel:"Forcer l'affichage de toutes les sources de données",onText:"actif",offText:"inactif",name:"datasourceForceDisplay",id:"datasourceForceDisplayU"+c.Id,state:c.rules.datasourceForceDisplay},{xtype:"toggleslidefield",fieldLabel:"Autoriser le test des sources de données",onText:"actif",offText:"inactif",name:"datasourceTest",id:"datasourceTestU"+c.Id,state:c.rules.datasourceTest},{xtype:"toggleslidefield",fieldLabel:"Afficher les logs des sources de données",onText:"actif",offText:"inactif",name:"datasourceDisplayLog",id:"datasourceDisplayLogU"+c.Id,state:c.rules.datasourceDisplayLog}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Configurations",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux configurations",onText:"actif",offText:"inactif",name:"settingDisplay",id:"settingDisplayU"+c.Id,state:c.rules.settingDisplay},{xtype:"toggleslidefield",fieldLabel:"Modifier des configurations",onText:"actif",offText:"inactif",name:"settingUpdate",id:"settingUpdateU"+c.Id,state:c.rules.settingUpdate},{xtype:"toggleslidefield",fieldLabel:"Afficher toutes les logs",onText:"actif",offText:"inactif",name:"settingDisplayLog",id:"settingDisplayLogU"+c.Id,state:c.rules.settingDisplayLog},{xtype:"toggleslidefield",fieldLabel:"Autoriser la modification du mot de passe",onText:"actif",offText:"inactif",name:"settingPasswordCanChange",id:"settingPasswordCanChangeU"+c.Id,state:c.rules.settingPasswordCanChange}]}],closable:true,active:true,tbar:[{text:"Enregistrer",key:"save",handler:workspaceUsers.task}]});e.user=b.raw;e.rec=b;e.workspace=workspaceUsers;e.propertySource={"(name)":c.username,ldapusername:c.ldapusername,description:Ext.encode({description_resume:"",description_details:""}),motscles:"",environnement:"",nodek:"",publiee:true};centerPanel.add(e);centerPanel.setActiveTab(e)}a.hide()})},gotoUserGroup:function(a){workspaceUsers.getGroup(a.raw.Id,function(c){var b=false;centerPanel.items.each(function(f,e,g){if(f.group&&c.Id==f.group.Id){b=true;centerPanel.setActiveTab(f)}});if(!b){var d=Ext.create("Ext.Panel",{title:a.raw.text,iconCls:"icon-user",items:[{xtype:"panel",frame:true,title:"Accueil",bodyStyle:"padding: 10px;",style:"margin-bottom:10px;",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Afficher la page d'accueil",onText:"actif",offText:"inactif",name:"welcomeDisplay",id:"welcomeDisplayG"+c.Id,state:c.rules.welcomeDisplay},{xtype:"toggleslidefield",fieldLabel:"Afficher les états qui datent de plus de 5 jours",onText:"actif",offText:"inactif",name:"welcomeMoreFiveDays",id:"welcomeMoreFiveDaysG"+c.Id,state:c.rules.welcomeMoreFiveDays},{xtype:"toggleslidefield",fieldLabel:"Afficher le nombre de téléchargement",onText:"actif",offText:"inactif",name:"welcomeCountDownload",id:"welcomeCountDownloadG"+c.Id,state:c.rules.welcomeCountDownload}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Requêtes",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux requêtes",onText:"actif",offText:"inactif",name:"queryDisplay",id:"queryDisplayG"+c.Id,state:c.rules.queryDisplay},{xtype:"toggleslidefield",fieldLabel:"Créer des groupe de requêtes",onText:"actif",offText:"inactif",name:"queryGroupCreate",id:"queryGroupCreateG"+c.Id,state:c.rules.queryGroupCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des groupes de requêtes",onText:"actif",offText:"inactif",name:"queryGroupUpdate",id:"queryGroupUpdateG"+c.Id,state:c.rules.queryGroupUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des groupes de requêtes",onText:"actif",offText:"inactif",name:"queryGroupDelete",id:"queryGroupDeleteG"+c.Id,state:c.rules.queryGroupDelete},{xtype:"toggleslidefield",fieldLabel:"Créer des requêtes",onText:"actif",offText:"inactif",name:"queryCreate",id:"queryCreateG"+c.Id,state:c.rules.queryCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des requêtes",onText:"actif",offText:"inactif",name:"queryUpdate",id:"queryUpdateG"+c.Id,state:c.rules.queryUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des requêtes",onText:"actif",offText:"inactif",name:"queryDelete",id:"queryDeleteG"+c.Id,state:c.rules.queryDelete},{xtype:"toggleslidefield",fieldLabel:"Forcer l'affichage de toutes les requêtes",onText:"actif",offText:"inactif",name:"queryForceDisplay",id:"queryForceDisplayG"+c.Id,state:c.rules.queryForceDisplay},{xtype:"toggleslidefield",fieldLabel:"Exécution des requêtes",onText:"actif",offText:"inactif",name:"queryRun",id:"queryRunG"+c.Id,state:c.rules.queryRun},{xtype:"toggleslidefield",fieldLabel:"Extraire les requêtes CSV",onText:"actif",offText:"inactif",name:"queryExtractCSV",id:"queryExtractCSVG"+c.Id,state:c.rules.queryExtractCSV},{xtype:"toggleslidefield",fieldLabel:"Afficher les logs des requêtes",onText:"actif",offText:"inactif",name:"queryDisplayLog",id:"queryDisplayLogG"+c.Id,state:c.rules.queryDisplayLog}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Rapports",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux rapports",onText:"actif",offText:"inactif",name:"reportDisplay",id:"reportDisplayG"+c.Id,state:c.rules.reportDisplay},{xtype:"toggleslidefield",fieldLabel:"Créer des groupe de rapports",onText:"actif",offText:"inactif",name:"reportGroupCreate",id:"reportGroupCreateG"+c.Id,state:c.rules.reportGroupCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des groupes de rapports",onText:"actif",offText:"inactif",name:"reportGroupUpdate",id:"reportGroupUpdateG"+c.Id,state:c.rules.reportGroupUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des groupes de rapports",onText:"actif",offText:"inactif",name:"reportGroupDelete",id:"reportGroupDeleteG"+c.Id,state:c.rules.reportGroupDelete},{xtype:"toggleslidefield",fieldLabel:"Créer des rapports",onText:"actif",offText:"inactif",name:"reportCreate",id:"reportCreateG"+c.Id,state:c.rules.reportCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des rapports",onText:"actif",offText:"inactif",name:"reportUpdate",id:"reportUpdateG"+c.Id,state:c.rules.reportUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des rapports",onText:"actif",offText:"inactif",name:"reportDelete",id:"reportDeleteG"+c.Id,state:c.rules.reportDelete},{xtype:"toggleslidefield",fieldLabel:"Forcer l'affichage de toutes les rapports",onText:"actif",offText:"inactif",name:"reportForceDisplay",id:"reportForceDisplayG"+c.Id,state:c.rules.reportForceDisplay},{xtype:"toggleslidefield",fieldLabel:"Exécuter les rapports",onText:"actif",offText:"inactif",name:"reportRun",id:"reportRunG"+c.Id,state:c.rules.reportRun},{xtype:"toggleslidefield",fieldLabel:"Extraire les rapports PDF",onText:"actif",offText:"inactif",name:"reportExtractPDF",id:"reportExtractPDFG"+c.Id,state:c.rules.reportExtractPDF},{xtype:"toggleslidefield",fieldLabel:"Extraire les rapports Microsoft Word",onText:"actif",offText:"inactif",name:"reportExtractDOC",id:"reportExtractDOCG"+c.Id,state:c.rules.reportExtractDOC},{xtype:"toggleslidefield",fieldLabel:"Afficher les logs des rapports",onText:"actif",offText:"inactif",name:"reportDisplayLog",id:"reportDisplayLogG"+c.Id,state:c.rules.reportDisplayLog}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Tâches plannifiées",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux tâches plannifiée",onText:"actif",offText:"inactif",name:"planningDisplay",id:"planningDisplayG"+c.Id,state:c.rules.planningDisplay},{xtype:"toggleslidefield",fieldLabel:"Créer des groupe de tâches",onText:"actif",offText:"inactif",name:"planningGroupCreate",id:"planningGroupCreateG"+c.Id,state:c.rules.planningGroupCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des groupes de tâches",onText:"actif",offText:"inactif",name:"planningGroupUpdate",id:"planningGroupUpdateG"+c.Id,state:c.rules.planningGroupUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des groupes de tâches",onText:"actif",offText:"inactif",name:"planningGroupDelete",id:"planningGroupDeleteG"+c.Id,state:c.rules.planningGroupDelete},{xtype:"toggleslidefield",fieldLabel:"Créer des tâches",onText:"actif",offText:"inactif",name:"planningCreate",id:"planningCreateG"+c.Id,state:c.rules.planningCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des tâches",onText:"actif",offText:"inactif",name:"planningUpdate",id:"planningUpdateG"+c.Id,state:c.rules.planningUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des tâches",onText:"actif",offText:"inactif",name:"planningDelete",id:"planningDeleteG"+c.Id,state:c.rules.planningDelete},{xtype:"toggleslidefield",fieldLabel:"Forcer l'affichage de toutes les tâches",onText:"actif",offText:"inactif",name:"planningForceDisplay",id:"planningForceDisplayG"+c.Id,state:c.rules.planningForceDisplay},{xtype:"toggleslidefield",fieldLabel:"Afficher les logs des tâches",onText:"actif",offText:"inactif",name:"planningDisplayLog",id:"planningDisplayLogG"+c.Id,state:c.rules.planningDisplayLog}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Utilisateurs",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux utilisateurs",onText:"actif",offText:"inactif",name:"userDisplay",id:"userDisplayG"+c.Id,state:c.rules.userDisplay},{xtype:"toggleslidefield",fieldLabel:"Créer des groupe de utilisateurs",onText:"actif",offText:"inactif",name:"userGroupCreate",id:"userGroupCreateG"+c.Id,state:c.rules.userGroupCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des groupes de utilisateurs",onText:"actif",offText:"inactif",name:"userGroupUpdate",id:"userGroupUpdateG"+c.Id,state:c.rules.userGroupUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des groupes de utilisateurs",onText:"actif",offText:"inactif",name:"userGroupDelete",id:"userGroupDeleteG"+c.Id,state:c.rules.userGroupDelete},{xtype:"toggleslidefield",fieldLabel:"Créer des utilisateurs",onText:"actif",offText:"inactif",name:"userCreate",id:"userCreateG"+c.Id,state:c.rules.userCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des utilisateurs",onText:"actif",offText:"inactif",name:"userUpdate",id:"userUpdateG"+c.Id,state:c.rules.userUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des utilisateurs",onText:"actif",offText:"inactif",name:"userDelete",id:"userDeleteG"+c.Id,state:c.rules.userDelete},{xtype:"toggleslidefield",fieldLabel:"Forcer l'affichage de toutes les utilisateurs",onText:"actif",offText:"inactif",name:"userForceDisplay",id:"userForceDisplayG"+c.Id,state:c.rules.userForceDisplay},{xtype:"textfield",fieldLabel:"Durée de session inactive",name:"sessionInactiveDelay",id:"sessionInactiveDelayG"+c.Id,value:a.raw.rules.sessionInactiveDelay},{xtype:"toggleslidefield",fieldLabel:"Désactiver les utilisateurs",onText:"actif",offText:"inactif",name:"userEnabled",id:"userEnabledG"+c.Id,state:c.rules.userEnabled},{xtype:"toggleslidefield",fieldLabel:"Afficher les logs des utilisateurs",onText:"actif",offText:"inactif",name:"userDisplayLog",id:"userDisplayLogG"+c.Id,state:c.rules.userDisplayLog}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Sources de données",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux sources de données",onText:"actif",offText:"inactif",name:"datasourceDisplay",id:"datasourceDisplayG"+c.Id,state:c.rules.datasourceDisplay},{xtype:"toggleslidefield",fieldLabel:"Créer des groupe de sources de données",onText:"actif",offText:"inactif",name:"datasourceGroupCreate",id:"datasourceGroupCreateG"+c.Id,state:c.rules.datasourceGroupCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des groupes de sources de données",onText:"actif",offText:"inactif",name:"datasourceGroupUpdate",id:"datasourceGroupUpdateG"+c.Id,state:c.rules.datasourceGroupUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des groupes de sources de données",onText:"actif",offText:"inactif",name:"datasourceGroupDelete",id:"datasourceGroupDeleteG"+c.Id,state:c.rules.datasourceGroupDelete},{xtype:"toggleslidefield",fieldLabel:"Créer des sources de données",onText:"actif",offText:"inactif",name:"datasourceCreate",id:"datasourceCreateG"+c.Id,state:c.rules.datasourceCreate},{xtype:"toggleslidefield",fieldLabel:"Modifier des sources de données",onText:"actif",offText:"inactif",name:"datasourceUpdate",id:"datasourceUpdateG"+c.Id,state:c.rules.datasourceUpdate},{xtype:"toggleslidefield",fieldLabel:"Supprimer des sources de données",onText:"actif",offText:"inactif",name:"datasourceDelete",id:"datasourceDeleteG"+c.Id,state:c.rules.datasourceDelete},{xtype:"toggleslidefield",fieldLabel:"Forcer l'affichage de toutes les sources de données",onText:"actif",offText:"inactif",name:"datasourceForceDisplay",id:"datasourceForceDisplayG"+c.Id,state:c.rules.datasourceForceDisplay},{xtype:"toggleslidefield",fieldLabel:"Autoriser le test des sources de données",onText:"actif",offText:"inactif",name:"datasourceTest",id:"datasourceTestG"+c.Id,state:c.rules.datasourceTest},{xtype:"toggleslidefield",fieldLabel:"Afficher les logs des sources de données",onText:"actif",offText:"inactif",name:"datasourceDisplayLog",id:"datasourceDisplayLogG"+c.Id,state:c.rules.datasourceDisplayLog}]},{xtype:"panel",frame:true,style:"margin-bottom:10px;",title:"Configurations",bodyStyle:"padding: 10px",cls:"subform",items:[{xtype:"toggleslidefield",fieldLabel:"Accès aux configurations",onText:"actif",offText:"inactif",name:"settingDisplay",id:"settingDisplayG"+c.Id,state:c.rules.settingDisplay},{xtype:"toggleslidefield",fieldLabel:"Modifier des configurations",onText:"actif",offText:"inactif",name:"settingUpdate",id:"settingUpdateG"+c.Id,state:c.rules.settingUpdate},{xtype:"toggleslidefield",fieldLabel:"Afficher toutes les logs",onText:"actif",offText:"inactif",name:"settingDisplayLog",id:"settingDisplayLogG"+c.Id,state:c.rules.settingDisplayLog},{xtype:"toggleslidefield",fieldLabel:"Autoriser la modification du mot de passe",onText:"actif",offText:"inactif",name:"settingPasswordCanChange",id:"settingPasswordCanChangeG"+c.Id,state:c.rules.settingPasswordCanChange}]}],closable:true,active:true,tbar:[{text:"Enregistrer",key:"save",handler:workspaceUsers.task},{text:"Forcer l'application sur les utilisateurs",key:"apply",handler:workspaceUsers.task}]});d.group=a.raw;d.rec=a;d.workspace=workspaceUsers;d.propertySource={"(name)":c.title,ldapusername:c.title,description:Ext.encode({description_resume:"",description_details:""}),motscles:"",environnement:"",nodek:"",publiee:true};centerPanel.add(d);centerPanel.setActiveTab(d)}})},onCenterTabChange:function(b,a){if("user" in a){workspaceUsers.current=a.user;workspaceUsers.propertyData.setSource(a.propertySource)}},itemUsers:Ext.create("Ext.tree.Panel",{title:"Utilisateurs",store:Ext.create("Ext.data.TreeStore",{model:"treeModel",proxy:{type:"memory"}}),viewConfig:{plugins:{ptype:"treeviewdragdrop"},listeners:{beforedrop:function(d,f,e,b,a,c){if((b=="before"||b=="after")&&e.parentNode.raw.text=="Root"){if(f.records[0].raw.nodek=="user"){a.cancelDrop()}}},drop:function(c,e,d,b){if(e.records[0].raw.nodek=="groupuser"){var f={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","group","user",f,function(g){})}else{if(e.records[0].raw.nodek=="user"){var a={id:e.records[0].raw.Id,groupid:d.raw.Id};symfony("save","user","user",a,function(g){if(workspaceUsers.current.Id==a.id){workspaceUsers.current.groupid=a.groupid}})}}}}},rootVisible:false,listeners:{afterrender:function(a,b){var c=new Ext.LoadMask(workspaceUsers.itemUsers,{msg:"Veuillez patienter ..."});c.show();symfony("list","user","user",{},function(d){var f=workspaceUsers.itemUsers.getStore();var e=f.setRootNode({children:d.data});Ext.apply(workspaceUsers.itemUsers,{store:f});c.hide()})},itemdblclick:function(b,e,d,c,a){if(e.get("leaf")){workspaceUsers.gotoUser(e)}},containercontextmenu:function(b,a){workspaceUsers.menuGroupUsers.rec=workspaceUsers.itemUsers.store.tree.root;workspaceUsers.menuRootGroupUsers.showAt(a.getXY());a.stopEvent()},itemcontextmenu:function(b,e,d,c,a){if(e.get("leaf")){workspaceUsers.menuUsers.rec=e;workspaceUsers.menuUsers.showAt(a.getXY())}else{Ext.getCmp("userdelete").setDisabled(false);if(e.raw.persist){Ext.getCmp("userdelete").setDisabled(true)}workspaceUsers.menuGroupUsers.rec=e;workspaceUsers.menuGroupUsers.showAt(a.getXY())}a.stopEvent()}}}),setProperties:function(a){$.each(a,function(b,c){workspaceUsers.propertySource[b]=c});workspaceUsers.propertyData.setSource(workspaceUsers.propertySource)},set:function(b,d){currentWorkspace=workspaceUsers;bottomPanel.hide();propertyPanel.removeAll();workspaceUsers.propertySource={"(name)":"name",ldapusername:"",description:Ext.encode({description_resume:"",description_details:""}),motscles:"",environnement:"",nodek:"",publiee:true};workspaceUsers.propertyData=Ext.create("Ext.grid.property.Grid",{title:"Propriétés",propertyNames:{"(name)":"(Nom)",ldapusername:"LDAP",description:"Description",motscles:"Mots clés",environnement:"Environnement",nodek:"Groupe",publiee:"Publiée"},listeners:{propertychange:function(k,h,j,g){if(h=="(name)"){var i=centerPanel.getActiveTab();i.rec.set("text",j);i.rec.raw.text=j;i.rec.raw.username=j;i.rec.commit();i.setTitle(j)}}},customEditors:{description:{xtype:"descriptionfield"},groupe:{xtype:"combobox"},environnement:{xtype:"combobox"}},customRenderers:{description:function(g){var j=Ext.decode(g),k=j.description_details,h=j.description_resume,i="";i+="<b>"+h+"</b>: ";i+="<i>"+k+"</i>";return i}},source:workspaceUsers.propertySource});propertyPanel.add(workspaceUsers.propertyData);propertyPanel.add(aboutTab());propertyPanel.setActiveTab(workspaceUsers.propertyData);var f=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1},{text:"Titre de la colonne",flex:1,sortable:1},{text:"Cadrage",flex:1,sortable:1},{text:"Format de date",flex:1,sortable:1},{text:"Largeur de la colonne",flex:1,sortable:1}]});var e=Ext.create("Ext.grid.Panel",{columnLines:true,columns:[{text:"Ordre",flex:1,sortable:1},{text:"Nom SQL",flex:1,sortable:1}]});bottomPanel.removeAll();var c=Ext.create("Ext.Panel",{title:"Paramètres d'affichage des colonnes",iconCls:"tabs",closable:false,items:[f]});var a=Ext.create("Ext.Panel",{title:"Résultats utilisateurs",iconCls:"tabs",html:"center south",closable:false,items:[e]});bottomPanel.add(c);bottomPanel.add(a);bottomPanel.setActiveTab(c);d()},getUser:function(b,a){symfony("get","user","user",{id:b},function(c){if(workspaceUsers.users[c.data.Id]===undefined){workspaceUsers.users[c.data.Id]={}}a(c.data)})},getGroup:function(b,a){symfony("get","group","user",{id:b},function(c){if(workspaceUsers.groups[c.data.Id]===undefined){workspaceUsers.groups[c.data.Id]={}}a(c.data)})},task:function(a){switch(a.key){case"save":var b=centerPanel.getActiveTab();var g="G";if(b.rec.raw.nodek=="user"){g="U"}var i=b.rec.raw.Id;var h={welcomeDisplay:Ext.getCmp("welcomeDisplay"+g+i).value,welcomeMoreFiveDays:Ext.getCmp("welcomeMoreFiveDays"+g+i).value,welcomeCountDownload:Ext.getCmp("welcomeCountDownload"+g+i).value,queryDisplay:Ext.getCmp("queryDisplay"+g+i).value,queryCreate:Ext.getCmp("queryCreate"+g+i).value,queryUpdate:Ext.getCmp("queryUpdate"+g+i).value,queryDelete:Ext.getCmp("queryDelete"+g+i).value,queryGroupCreate:Ext.getCmp("queryGroupCreate"+g+i).value,queryGroupUpdate:Ext.getCmp("queryGroupUpdate"+g+i).value,queryGroupDelete:Ext.getCmp("queryGroupDelete"+g+i).value,queryForceDisplay:Ext.getCmp("queryForceDisplay"+g+i).value,reportDisplay:Ext.getCmp("reportDisplay"+g+i).value,reportCreate:Ext.getCmp("reportCreate"+g+i).value,reportUpdate:Ext.getCmp("reportUpdate"+g+i).value,reportDelete:Ext.getCmp("reportDelete"+g+i).value,reportGroupCreate:Ext.getCmp("reportGroupCreate"+g+i).value,reportGroupUpdate:Ext.getCmp("reportGroupUpdate"+g+i).value,reportGroupDelete:Ext.getCmp("reportGroupDelete"+g+i).value,reportForceDisplay:Ext.getCmp("reportForceDisplay"+g+i).value,planningDisplay:Ext.getCmp("planningDisplay"+g+i).value,planningCreate:Ext.getCmp("planningCreate"+g+i).value,planningUpdate:Ext.getCmp("planningUpdate"+g+i).value,planningDelete:Ext.getCmp("planningDelete"+g+i).value,planningGroupCreate:Ext.getCmp("planningGroupCreate"+g+i).value,planningGroupUpdate:Ext.getCmp("planningGroupUpdate"+g+i).value,planningGroupDelete:Ext.getCmp("planningGroupDelete"+g+i).value,planningForceDisplay:Ext.getCmp("planningForceDisplay"+g+i).value,userDisplay:Ext.getCmp("userDisplay"+g+i).value,userCreate:Ext.getCmp("userCreate"+g+i).value,userUpdate:Ext.getCmp("userUpdate"+g+i).value,userDelete:Ext.getCmp("userDelete"+g+i).value,userGroupCreate:Ext.getCmp("userGroupCreate"+g+i).value,userGroupUpdate:Ext.getCmp("userGroupUpdate"+g+i).value,userGroupDelete:Ext.getCmp("userGroupDelete"+g+i).value,userForceDisplay:Ext.getCmp("userForceDisplay"+g+i).value,datasourceDisplay:Ext.getCmp("datasourceDisplay"+g+i).value,datasourceCreate:Ext.getCmp("datasourceCreate"+g+i).value,datasourceUpdate:Ext.getCmp("datasourceUpdate"+g+i).value,datasourceDelete:Ext.getCmp("datasourceDelete"+g+i).value,datasourceGroupCreate:Ext.getCmp("datasourceGroupCreate"+g+i).value,datasourceGroupUpdate:Ext.getCmp("datasourceGroupUpdate"+g+i).value,datasourceGroupDelete:Ext.getCmp("datasourceGroupDelete"+g+i).value,datasourceForceDisplay:Ext.getCmp("datasourceForceDisplay"+g+i).value,settingDisplay:Ext.getCmp("settingDisplay"+g+i).value,settingUpdate:Ext.getCmp("settingUpdate"+g+i).value,queryRun:Ext.getCmp("queryRun"+g+i).value,reportRun:Ext.getCmp("reportRun"+g+i).value,userEnabled:Ext.getCmp("userEnabled"+g+i).value,queryExtractCSV:Ext.getCmp("queryExtractCSV"+g+i).value,reportExtractPDF:Ext.getCmp("reportExtractPDF"+g+i).value,reportExtractDOC:Ext.getCmp("reportExtractDOC"+g+i).value,datasourceTest:Ext.getCmp("datasourceTest"+g+i).value,datasourceDisplayLog:Ext.getCmp("datasourceDisplayLog"+g+i).value,queryDisplayLog:Ext.getCmp("queryDisplayLog"+g+i).value,reportDisplayLog:Ext.getCmp("reportDisplayLog"+g+i).value,planningDisplayLog:Ext.getCmp("planningDisplayLog"+g+i).value,userDisplayLog:Ext.getCmp("userDisplayLog"+g+i).value,settingDisplayLog:Ext.getCmp("settingDisplayLog"+g+i).value,sessionInactiveDelay:Ext.getCmp("sessionInactiveDelay"+g+i).value,settingPasswordCanChange:Ext.getCmp("settingPasswordCanChange"+g+i).value,userid:(g=="U")?i:0,usergroupid:(g=="G")?i:0};var e={};var f="";if(g=="G"){e={id:i,rules:h};f="group"}if(g=="U"){var d=workspaceUsers.propertyData.source["(name)"];workspaceUsers.current.username=d;workspaceUsers.current.ldapusername=workspaceUsers.propertyData.source.ldapusername;e={id:workspaceUsers.current.Id,username:workspaceUsers.current.username,ldapusername:workspaceUsers.current.ldapusername,groupid:workspaceUsers.current.groupid,rules:h};f="user"}var c=new Ext.LoadMask(centerPanel,{msg:"Sauvegarde en cours ..."});c.show();symfony("save",f,"user",e,function(j){c.hide()});break}}};