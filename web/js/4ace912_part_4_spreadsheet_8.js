var globalSpreadbox=[];var isFirefox=!(window.mozInnerScreenX==null);function initSpreadBox(a){globalSpreadbox[a]={};globalSpreadbox[a].sheet=$("#sheet");globalSpreadbox[a].spreadbox=$("#spreadbox");globalSpreadbox[a].sheetEl=$("#sheet").get()[0];globalSpreadbox[a].spreadboxEl=$("#spreadbox").get()[0];globalSpreadbox[a].rowshead=[];globalSpreadbox[a].columnshead=[];globalSpreadbox[a].cells=[];globalSpreadbox[a].rowsline=[];globalSpreadbox[a].resizerowboxDown=null;globalSpreadbox[a].resizerowboxY=0;globalSpreadbox[a].resizecolumnboxDown=null;globalSpreadbox[a].resizecolumnboxX=0;globalSpreadbox[a].sizeHztdiv=0;globalSpreadbox[a].sizeVrtdiv=0;globalSpreadbox[a].sizeableIndex=0;globalSpreadbox[a].horizontalSlide=0;globalSpreadbox[a].slideLeftToCellID=0;globalSpreadbox[a].verticalSlide=0;globalSpreadbox[a].slideTopToCellID=0;globalSpreadbox[a].firstcell=null;globalSpreadbox[a].secondcell=null;globalSpreadbox[a].sheetMouseDown=false;globalSpreadbox[a].sheetBarreTop=false;globalSpreadbox[a].sheetBarreLeft=false;globalSpreadbox[a].columnselected=[];globalSpreadbox[a].rowselected=[];globalSpreadbox[a].SX=0;globalSpreadbox[a].SY=0;globalSpreadbox[a].sheetScrolled=0;globalSpreadbox[a].visibleCells=[];globalSpreadbox[a].sheetEl.scrollTopFixe=0;var c=$("#spreadbox").parent().width()-50;var b=$("#spreadbox").parent().height()-20;$("#spreadbox #columnsbox").width(c);$("#spreadbox #contener").width(c);$("#spreadbox #sheet").width(c);$("#spreadbox #rowsbox").height(b);$("#spreadbox #contener").height(b);$("#spreadbox #sheet").height(b);var d=$("#spreadbox").parent().parent().parent().parent().id;alert(Ext.getCmp(d).title);globalSpreadbox[a].selector1=$("<div/>",{id:"selector1"});globalSpreadbox[a].selector1.css("visibility","hidden");globalSpreadbox[a].selector3=$("<div/>",{id:"selector3"});globalSpreadbox[a].selector3.css("visibility","hidden");globalSpreadbox[a].selector2=$("<div/>",{id:"selector2"});globalSpreadbox[a].selector2.css("visibility","hidden");globalSpreadbox[a].sizeableVrtdiv=$("<div/>",{id:"sizeableVrtdiv"});globalSpreadbox[a].sizeableVrtdiv.height(globalSpreadbox[a].spreadbox.height());globalSpreadbox[a].sizeableVrtdiv.css("marginTop","-"+(globalSpreadbox[a].spreadbox.height())+"px");globalSpreadbox[a].sizeableVrtdiv.html("<div></div>");globalSpreadbox[a].sizeableHztdiv=$("<div/>",{id:"sizeableHztdiv"});globalSpreadbox[a].sizeableHztdiv.width(globalSpreadbox[a].spreadbox.width());globalSpreadbox[a].sizeableHztdiv.css("top","-"+(globalSpreadbox[a].spreadbox.height()-5)+"px");globalSpreadbox[a].sizeableHztdiv.html("<div></div>");$("#spreadboxline2").height(globalSpreadbox[a].sheet.height());$(document).on("mousemove",function(f){globalSpreadbox[a].mousemove(f,a)});$(document).on("mousedown",function(f){globalSpreadbox[a].mousedown(f,a)});$(document).on("mouseup",function(f){globalSpreadbox[a].mouseup(f,a)});$("#sheet").on("scroll",function(f){$("#columnsbox").get()[0].scrollLeft=globalSpreadbox[a].sheetEl.scrollLeft;$("#rowsbox").get()[0].scrollTop=globalSpreadbox[a].sheetEl.scrollTop;if(isFirefox){if(globalSpreadbox[a].sheetEl.scrollTop==(globalSpreadbox[a].sheetEl.scrollHeight-globalSpreadbox[a].sheetEl.clientHeight)){globalSpreadbox[a].sheetEl.scrollTopFixe=-1}if(globalSpreadbox[a].sheetEl.scrollTop==0&&globalSpreadbox[a].sheetEl.scrollTopFixe!=0){globalSpreadbox[a].sheetEl.scrollTopFixe=0}}$("#rowsbox").get()[0].scrollTop+=globalSpreadbox[a].sheetEl.scrollTopFixe;globalSpreadbox[a].getVisiblesCells(a)});$("#sheet").append(globalSpreadbox[a].selector1);$("#sheet").append(globalSpreadbox[a].selector2);$("#sheet").append(globalSpreadbox[a].selector3);$("#spreadbox").append(globalSpreadbox[a].sizeableHztdiv);$("#spreadbox").append(globalSpreadbox[a].sizeableVrtdiv)}function startSpreadBox(a){initSpreadBox(a);globalSpreadbox[a].addmatrix(100,26,a);globalSpreadbox[a].getVisiblesCells(a)}globalSpreadbox[sheetnumber].addmatrix=function(q,c,d){var j=$(".rowhead").size();var a=$("#rowsbox > div");for(i=0;i<q;i++){rindex=j+i+1;rsizeh=20;var e=$("<div/>",{"class":"rowhead head",kind:"header"});e.attr("index",rindex);e.height(rsizeh);e.attr("sizeh",rsizeh);globalSpreadbox[d].rowshead[rindex]=e;globalSpreadbox[d].cells[rindex-1]=[];var k=$("<div/>",{"class":"contentrowbox"});k.css("height",rsizeh+"px");k.html(rindex);var l=$("<div/>",{"class":"resizerowbox"});l.attr("index",rindex);l.on("mousedown",function(s){if(globalSpreadbox[d].resizerowboxDown==null){globalSpreadbox[d].sizeableHztdiv.css("display","block");var r=$(s.target).offset().top-$("#spreadbox").offset().top-1;r=-(globalSpreadbox[d].spreadbox.height()-5)+r+1;globalSpreadbox[d].sizeableHztdiv.css("top",r+"px");globalSpreadbox[d].resizerowboxY=r;globalSpreadbox[d].resizerowboxDown=s.pageY;globalSpreadbox[d].sizeableIndex=parseInt($(s.target).attr("index"))}});e.append(k);e.append(l);a.append(e);var p=$("<div/>",{"class":"row"});p.attr("index",rindex);p.height(rsizeh);p.attr("sizeh",rsizeh);p.get()[0].head=e;globalSpreadbox[d].rowsline[rindex]=p;globalSpreadbox[d].sheet.append(p)}var g=a.height()+100;a.height(g);var f=$(".columnhead").size();var n=$("#columnsbox > div");var o=n.width();if(f==0){o=100}for(i=0;i<c;i++){cindex=f+i+1;csizew=100;var m=$("<div/>",{"class":"columnhead head",kind:"header"});m.attr("index",cindex);m.width(csizew);m.attr("sizew",csizew);globalSpreadbox[d].columnshead[cindex]=m;var b=$("<div/>",{"class":"contentcolumnbox"});b.css("width",(csizew-5)+"px");b.html(String.fromCharCode(64+cindex));var h=$("<div/>",{"class":"resizecolumnbox"});h.attr("index",cindex);h.on("mousedown",function(s){if(globalSpreadbox[d].resizecolumnboxDown==null){globalSpreadbox[d].sizeableVrtdiv.css("display","block");var r=$(s.target).offset().left-$("#spreadbox").offset().left;globalSpreadbox[d].sizeableVrtdiv.css("left",r+"px");globalSpreadbox[d].resizecolumnboxX=r;globalSpreadbox[d].resizecolumnboxDown=s.pageX;globalSpreadbox[d].sizeableIndex=parseInt($(s.target).attr("index"))}});m.append(b);m.append(h);n.append(m);o+=csizew;$("#sheet .row").each(function(s){var t=$(this).height();var r=$("<div/>",{"class":"cell"});r.width(csizew);r.height(t);r.attr("sizew",csizew);r.attr("sizeh",t);r.get()[0].column=m;r.get()[0].row=this.head;r.attr("address",s+" "+cindex);globalSpreadbox[d].cells[parseInt($(this).attr("index"))-1][cindex-1]=r;$(this).append(r)})}n.width(o)};globalSpreadbox[sheetnumber].slideLeftToCell=function(a,b){if(globalSpreadbox[b].sheetMouseDown&&globalSpreadbox[b].sheetBarreLeft&&globalSpreadbox[b].slideLeftToCellID==0){globalSpreadbox[b].slideLeftToCellID=setInterval(function(){globalSpreadbox[b].sheetEl.scrollLeft+=globalSpreadbox[b].horizontalSlide*10},1)}};globalSpreadbox[sheetnumber].slideTopToCell=function(a,b){if(globalSpreadbox[b].sheetMouseDown&&globalSpreadbox[b].sheetBarreTop&&globalSpreadbox[b].slideTopToCellID==0){globalSpreadbox[b].slideTopToCellID=setInterval(function(){globalSpreadbox[b].sheetEl.scrollTop+=globalSpreadbox[b].verticalSlide*10},1)}};globalSpreadbox[sheetnumber].stopSlideLeft=function(a){clearInterval(globalSpreadbox[a].slideLeftToCellID);globalSpreadbox[a].slideLeftToCellID=0};globalSpreadbox[sheetnumber].stopSlideTop=function(a){clearInterval(globalSpreadbox[a].slideTopToCellID);globalSpreadbox[a].slideTopToCellID=0};globalSpreadbox[sheetnumber].getColumnFromCursor=function(g,d){var h=null;for(var c=0;c<globalSpreadbox[d].visibleCells.length;c++){var j=globalSpreadbox[d].visibleCells[c];var a=j.offsetLeft-globalSpreadbox[d].sheetEl.scrollLeft;var k=j.offsetTop-globalSpreadbox[d].sheetEl.scrollTop;var f=j.offsetWidth;var b=j.offsetHeight;if((g.pageX>=a&&g.pageX<=a+f)&&(g.pageY>=k&&g.pageY<=k+b)){h=j;break}}return h};globalSpreadbox[sheetnumber].mousedown=function(c,a){if((c.pageX>$("#sheet").offset().left+$("#sheet").get()[0].clientWidth)||(c.pageY>$("#sheet").offset().top+$("#sheet").get()[0].clientHeight)){return}globalSpreadbox[a].sheetMouseDown=true;var b=globalSpreadbox[a].getColumnFromCursor(c,a);if(b==null){return}if($(b).hasClass("cell")){if((globalSpreadbox[a].resizecolumnboxDown==null)&&(globalSpreadbox[a].resizerowboxDown==null)){globalSpreadbox[a].selector2.css("visibility","hidden");globalSpreadbox[a].selector2.removeClass("selector2_border");globalSpreadbox[a].selector3.css("visibility","hidden");if(globalSpreadbox[a].selector1.css("visibility")==="hidden"){globalSpreadbox[a].selector1.css("visibility","visible")}cell=$(b);globalSpreadbox[a].positionSelector(cell,a);globalSpreadbox[a].positionSelection(globalSpreadbox[a].firstcell,cell,a)}}if(typeof b.id!==typeof undefined&&b.id==="selector1"){globalSpreadbox[a].firstcell=globalSpreadbox[a].selector1.cell}};globalSpreadbox[sheetnumber].positionSelector=function(a,b){if(a!=null){globalSpreadbox[b].firstcell=a;globalSpreadbox[b].selector1.cell=a;globalSpreadbox[b].selector1.css("top",(a.height()+globalSpreadbox[b].sheet.scrollTop()+a.offset().top-globalSpreadbox[b].sheet.offset().top+2)+"px");globalSpreadbox[b].selector1.css("left",(a.offset().left+globalSpreadbox[b].sheet.scrollLeft()-globalSpreadbox[b].sheet.offset().left-2)+"px");globalSpreadbox[b].selector1.css("width",(a.width()-2)+"px");globalSpreadbox[b].selector1.css("height",(a.height()-2)+"px");globalSpreadbox[b].selector1.css("marginTop","-"+(globalSpreadbox[b].selector1.height()+6)+"px")}};globalSpreadbox[sheetnumber].mouseup=function(h,d){clearInterval(globalSpreadbox[d].slideLeftToCellID);clearInterval(globalSpreadbox[d].slideTopToCellID);globalSpreadbox[d].slideLeftToCellID=0;globalSpreadbox[d].slideTopToCellID=0;if(globalSpreadbox[d].resizecolumnboxDown!=null){var a=globalSpreadbox[d].columnshead[globalSpreadbox[d].sizeableIndex];a.width(a.width()+globalSpreadbox[d].sizeVrtdiv);a.find(".contentcolumnbox").css("width",(a.width()-5)+"px");var k=parseInt(a.attr("index"));for(var c=0;c<globalSpreadbox[d].cells.length;c++){globalSpreadbox[d].cells[c][k-1].width(a.width())}globalSpreadbox[d].sizeVrtdiv=0;globalSpreadbox[d].positionSelector(globalSpreadbox[d].selector2.cell1,d);globalSpreadbox[d].positionSelection(globalSpreadbox[d].selector2.cell1,globalSpreadbox[d].selector2.cell2,d);globalSpreadbox[d].selector3.offset({top:globalSpreadbox[d].SY,left:globalSpreadbox[d].SX})}if(globalSpreadbox[d].resizerowboxDown!=null){var g=globalSpreadbox[d].rowshead[globalSpreadbox[d].sizeableIndex];g.height(g.height()+globalSpreadbox[d].sizeHztdiv);var b=g.height()+"px";var j=g.height()+"px";g.find(".contentrowbox").css("height",b);g.find(".contentrowbox").css("line-height",b);var f=parseInt(g.attr("index"));globalSpreadbox[d].rowsline[f].css("height",j);globalSpreadbox[d].rowsline[f].css("line-height",j);cellsr=globalSpreadbox[d].cells[f-1];for(var c=0;c<cellsr.length;c++){cellsr[c].css("height",j);cellsr[c].css("line-height",j)}globalSpreadbox[d].sizeHztdiv=0;globalSpreadbox[d].positionSelector(globalSpreadbox[d].selector2.cell1,d);globalSpreadbox[d].positionSelection(globalSpreadbox[d].selector2.cell1,globalSpreadbox[d].selector2.cell2,d);globalSpreadbox[d].selector3.offset({top:globalSpreadbox[d].SY,left:globalSpreadbox[d].SX})}globalSpreadbox[d].resizecolumnboxDown=null;globalSpreadbox[d].resizerowboxDown=null;globalSpreadbox[d].sizeableVrtdiv.css("display","none");globalSpreadbox[d].sizeableHztdiv.css("display","none");globalSpreadbox[d].sheetMouseDown=false;if(globalSpreadbox[d].firstcell!=null){globalSpreadbox[d].selector3.css("visibility","visible");globalSpreadbox[d].selector3.offset({top:globalSpreadbox[d].SY,left:globalSpreadbox[d].SX})}if(globalSpreadbox[d].selector2.css("visibility")!=="hidden"){globalSpreadbox[d].selector2.addClass("selector2_border")}globalSpreadbox[d].selectHeaders(globalSpreadbox[d].firstcell,globalSpreadbox[d].secondcell,true,d);globalSpreadbox[d].firstcell=null};globalSpreadbox[sheetnumber].mousemove=function(f,b){globalSpreadbox[b].sheetBarreLeft=false;globalSpreadbox[b].sheetBarreTop=false;globalSpreadbox[b].horizontalSlide=0;if(f.pageX>$("#sheet").offset().left+$("#sheet").get()[0].clientWidth){globalSpreadbox[b].horizontalSlide=1}if(f.pageX<$("#sheet").offset().left){globalSpreadbox[b].horizontalSlide=-1}globalSpreadbox[b].verticalSlide=0;if(f.pageY>$("#sheet").offset().top+$("#sheet").get()[0].clientHeight){globalSpreadbox[b].verticalSlide=1}if(f.pageY<$("#sheet").offset().top){globalSpreadbox[b].verticalSlide=-1}var d=globalSpreadbox[b].getColumnFromCursor(f,b);if(globalSpreadbox[b].sheetMouseDown&&globalSpreadbox[b].resizecolumnboxDown!=null){var a=globalSpreadbox[b].resizecolumnboxX+f.pageX-globalSpreadbox[b].resizecolumnboxDown;if(globalSpreadbox[b].horizontalSlide==0){globalSpreadbox[b].sizeVrtdiv=f.pageX-globalSpreadbox[b].resizecolumnboxDown;globalSpreadbox[b].sizeableVrtdiv.css("left",a+"px")}return}if(globalSpreadbox[b].sheetMouseDown&&globalSpreadbox[b].resizerowboxDown!=null){var c=globalSpreadbox[b].resizerowboxY+f.pageY-globalSpreadbox[b].resizerowboxDown;if(globalSpreadbox[b].verticalSlide==0){globalSpreadbox[b].sizeHztdiv=f.pageY-globalSpreadbox[b].resizerowboxDown;globalSpreadbox[b].sizeableHztdiv.css("top",c+"px")}return}if(globalSpreadbox[b].horizontalSlide!=0){globalSpreadbox[b].sheetBarreLeft=true;globalSpreadbox[b].slideLeftToCell($(d),b)}else{globalSpreadbox[b].stopSlideLeft(b)}if(globalSpreadbox[b].verticalSlide!=0){globalSpreadbox[b].sheetBarreTop=true;globalSpreadbox[b].slideTopToCell($(d),b)}else{globalSpreadbox[b].stopSlideTop(b)}cell=$(d);if(!cell.hasClass("cell")){globalSpreadbox[b].selectHeaders(globalSpreadbox[b].firstcell,globalSpreadbox[b].secondcell,b)}if(globalSpreadbox[b].firstcell!=null&&cell.hasClass("cell")){globalSpreadbox[b].positionSelection(globalSpreadbox[b].firstcell,cell,b)}else{if(d!=null&&d.id==="selector1"){globalSpreadbox[b].selector2.css("visibility","hidden")}}};globalSpreadbox[sheetnumber].selectHeaders=function(o,n,e,l){if(o==null||n==null){return}if(!globalSpreadbox[l].sheetBarreTop||e){for(var k=0;k<globalSpreadbox[l].columnselected.length;k++){globalSpreadbox[l].columnselected[k].removeClass("columnselected")}globalSpreadbox[l].columnselected=[];var j=parseInt(o.get()[0].column.attr("index"));var h=parseInt(n.get()[0].column.attr("index"));var d=Math.min(j,h);var b=Math.max(j,h);for(var k=d;k<=b;k++){var m=globalSpreadbox[l].columnshead[k];m.addClass("columnselected");globalSpreadbox[l].columnselected.push(m)}}if(!globalSpreadbox[l].sheetBarreLeft||e){for(var k=0;k<globalSpreadbox[l].rowselected.length;k++){globalSpreadbox[l].rowselected[k].removeClass("rowselected")}globalSpreadbox[l].rowselected=[];var g=parseInt(o.get()[0].row.attr("index"));var f=parseInt(n.get()[0].row.attr("index"));var q=Math.min(g,f);var p=Math.max(g,f);for(var k=q;k<=p;k++){var a=globalSpreadbox[l].rowshead[k];a.addClass("rowselected");globalSpreadbox[l].rowselected.push(a)}}};globalSpreadbox[sheetnumber].positionSelection=function(c,b,a){if(c!=null&&b!=null){globalSpreadbox[a].secondcell=b;globalSpreadbox[a].selectHeaders(c,b,false,a);x1=c.offset().left;x2=x1+c.width();x3=b.offset().left;x4=x3+b.width();y1=c.offset().top;y2=y1+c.height();y3=b.offset().top;y4=y3+b.height();X=Math.min(x1,x3)-1;Y=Math.min(y1,y3)-1;W=Math.max(x2,x4)-X-1;H=Math.max(y2,y4)-Y-1;globalSpreadbox[a].SY=Y+H-3;globalSpreadbox[a].SX=X+W-3;if(c.attr("address")===b.attr("address")){globalSpreadbox[a].selector2.css("visibility","hidden");return}if(globalSpreadbox[a].selector2.css("visibility")==="hidden"){globalSpreadbox[a].selector2.css("visibility","visible")}globalSpreadbox[a].selector2.css("marginTop","-"+(H+2)+"px");globalSpreadbox[a].selector2.offset({top:Y,left:X});globalSpreadbox[a].selector2.css("width",(W-1)+"px");globalSpreadbox[a].selector2.css("height",H+"px");globalSpreadbox[a].selector2.cell1=c;globalSpreadbox[a].selector2.cell2=b}};globalSpreadbox[sheetnumber].getRandomInt=function(b,a){return Math.floor(Math.random()*(a-b))+b};globalSpreadbox[sheetnumber].getVisiblesCells=function(e){var j=globalSpreadbox[e].getRandomInt(1000,9999);globalSpreadbox[e].sheetScrolled=j;var k=$(".row").get();var b=[];for(var d=0;d<k.length;d++){if(j!=globalSpreadbox[e].sheetScrolled){return}if(k[d].offsetTop-globalSpreadbox[e].spreadboxEl.offsetTop+k[d].offsetHeight<globalSpreadbox[e].sheetEl.scrollTop){continue}if(k[d].offsetTop-globalSpreadbox[e].spreadboxEl.offsetTop-$("#columnsbox").height()>globalSpreadbox[e].sheetEl.scrollTop+globalSpreadbox[e].sheetEl.offsetHeight){continue}b.push($(k[d]))}var f=[];for(var d=0;d<b.length;d++){var a=b[d];var h=a.find(".cell").get();for(var g=0;g<h.length;g++){if(j!=globalSpreadbox[e].sheetScrolled){return}if(h[g].offsetLeft-globalSpreadbox[e].spreadboxEl.offsetLeft+h[g].offsetWidth<globalSpreadbox[e].sheetEl.scrollLeft){continue}if(h[g].offsetLeft-globalSpreadbox[e].spreadboxEl.offsetLeft-$("#rowsbox").width()>globalSpreadbox[e].sheetEl.scrollLeft+globalSpreadbox[e].sheetEl.offsetWidth){continue}f.push(h[g])}}globalSpreadbox[e].visibleCells=f};