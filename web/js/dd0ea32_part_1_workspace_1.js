var accordionPanel={};var propertyPanel={};var centerPanel={};var bottomPanel={};var currentWorkspace={name:""};var clipboard={kind:"empty"};function aboutTab(){var a="";a+='<div align="center">';a+="<div><br/></div>";a+='<div class="totem-logo"></div>';a+="<div><b>Totem</b></div>";a+="<div>0.0.1.34 alpha</div>";a+="<div><br/></div>";a+="<div>Totem est une application de génération de rapports basés sur les enregistrements d'une ou plusieurs bases de données</div>";a+="<div><br/></div>";a+='<div>Développé par : <a href="mailto:martinien.olingaayissi@t2safrica.com">Martinien OLINGA AYISSI</a></div>';a+="<div>Ingénieur Système Linux</div>";a+="<div>T2SA - DSR</div>";a+="<div><br/></div>";a+="<div><b>Technologies utilisées</b></div>";a+="<div><br/></div>";a+="<div>Ext.Js 4.2.1.883</div>";a+="<div>Extensible 1.5.2</div>";a+="<div>Codemirror 5.3.1</div>";a+="<div>jQuery 2.1.4</div>";a+="<div><br/></div>";a+="<div>Symfony 2.3.30</div>";a+="<div>Html2Pdf 4.03</div>";a+="<div>FR3D 2.0.0</div>";a+="</div>";return Ext.create("Ext.Panel",{title:"A propos de Totem",html:a})}var firstCenterDisplay=true;function replaceAll(d,a,c){var b=new RegExp(d,"g");c=c.replace(b,a);return c}function showobject(b){var c=$('<div style="padding:5px; overflow:scroll; position: absolute; display:block; width:700px; height:400px; background-color:white; border:5px solid black; z-index:100000; left:10px; top:10px">');c.append($("<div>").append($("<button>").html("close").on("click",function(){c.remove()})).append($("<hr>")));var a=$('<table width="100%" border="0" style="padding-bottom:30px;">');a.append($("<tr>").append($("<td>").html("<b>KEY</b>")).append($("<td>").html("<b>VALUE</b>")));$.each(b,function(e,g){var d=$('<td style="font-weight:bold;">').html(e);d.obj=g;d.on("click",function(h){showobject(d.obj)});var f=$("<td>").html(""+g);a.append($("<tr>").append(d).append(f))});c.append(a);$("body").append(c)}function customField(b,c,d,a){Ext.define(b,{extend:"Ext.form.field.Picker",alias:"widget."+c,editable:false,hideTrigger:true,pickerOffset:[0,-24],listeners:{focus:function(f,h,g){f.expand()}},cancelEdit:function(){var e=this;e.fireEvent("blur");e.collapse()},applyValues:function(){var f=this,e=f.picker,g=e.getForm().getValues();f.setValue(Ext.encode(g));f.fireEvent("blur");f.collapse()},createPicker:function(){var e=this,f=Ext.String.format;return Ext.create("Ext.form.Panel",{title:d,bodypadding:5,pickerField:e,ownerCt:e.ownerCt,renderTo:document.body,floating:true,bodyPadding:8,items:a,dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"button",name:"cancel",text:"Annuler",iconCls:"cancelicon",handler:function(g,i,h){e.cancelEdit()}},"->",{xtype:"button",name:"save",text:"OK",iconCls:"accepticon",handler:function(g,i,h){e.applyValues()}}]}],listeners:{afterrender:function(g,h){g.getForm().setValues(Ext.decode(e.getValue()))}}})}})}customField("DescriptionField","descriptionfield","Description",[{xtype:"textfield",fieldLabel:"Résumé",labelAlign:"top",anchor:"100%",name:"description_resume"},{xtype:"textareafield",fieldLabel:"Détails",labelAlign:"top",anchor:"100%",name:"description_details"}]);Ext.require(["*"]);Ext.onReady(function(){var a=new Ext.LoadMask(Ext.getBody(),{msg:"Veuillez patienter ..."});a.show();symfony("get","logged","user",{},function(d){workspaceUsers.logged=d.data;workspaceQueries.init();workspaceReports.init();workspacePlannings.init();workspaceUsers.init();workspaceDatasources.init();workspaceSettings.init();a.hide();propertyPanel=Ext.create("Ext.tab.Panel",{tabPosition:"bottom",region:"west",collapsible:true,split:true,width:330,minWidth:220,minHeight:140,title:"Etat",activeTab:0,layout:{type:"vbox",padding:5,align:"stretch"},items:[]});bottomPanel=Ext.create("Ext.tab.Panel",{id:"bottom-panel",title:"Splitter above me",resizeTabs:true,enableTabScroll:true,region:"south",height:300,split:true,collapsible:true,frame:true,minHeight:60,weight:-100,defaults:{autoScroll:true,bodyPadding:10},items:[]});accordionPanel=Ext.create("Ext.Panel",{id:"accordion",region:"west",split:true,width:250,layout:"accordion",items:[(workspaceUsers.logged.rules.queryDisplay)?workspaceQueries.itemQueries:null,(workspaceUsers.logged.rules.reportDisplay)?workspaceReports.itemReports:null,(workspaceUsers.logged.rules.planningDisplay)?workspacePlannings.itemPlannings:null,(workspaceUsers.logged.rules.userDisplay)?workspaceUsers.itemUsers:null,(workspaceUsers.logged.rules.datasourceDisplay)?workspaceDatasources.itemDatasources:null,(workspaceUsers.logged.rules.settingDisplay)?workspaceSettings.itemSettings:null],tbar:[{text:"Se déconnecter",iconCls:"icon-logout",key:"logout",handler:function(){symfony("logout","user","user",{},function(i){document.location="./logout"})}}]});var f=Ext.create("Ext.Panel",{title:"Accueil",iconCls:"icon-home",html:'<div id="welcomediv"></div>',closable:false});f.welcome=true;centerPanel=Ext.create("Ext.tab.Panel",{region:"center",id:"centerPanel",resizeTabs:true,enableTabScroll:true,minHeight:80,frame:true,defaults:{autoScroll:true,bodyPadding:10},items:[f],listeners:{tabchange:function(j,i){if(i.workspace!==undefined){currentWorkspace=i.workspace;currentWorkspace.set({tab:i},function(){currentWorkspace.onCenterTabChange(j,i)})}else{if(i.welcome!==undefined){h()}}}}});workspaceReports.set({tab:"welcome"},function(){h()});function h(){bottomPanel.hide();var j=centerPanel;if(firstCenterDisplay){j=Ext.getBody();firstCenterDisplay=false}propertyPanel.removeAll();var i=aboutTab();propertyPanel.add(i);propertyPanel.setActiveTab(i);var k=new Ext.LoadMask(j,{msg:"Chargement en cours ..."});k.show();symfony("get","files","report",{},function(l){var m="<div>";$.each(l.data,function(n,o){m+='<div class="totem-files"><a href="./file?'+o.Id+'">'+o.text+"</a></div>"});m+="</div>";$("#welcomediv").html(m);k.hide()})}var b;function g(l,k,m,i){var j=m.ownerCt;e.unshift(j.initialConfig);c.remove(j)}var e=[{region:"north",title:"North 2",height:100,collapsible:true,weight:-120},{region:"east",title:"East 2",width:100,collapsible:true,weight:-110},{region:"west",title:"West 2",width:100,collapsible:true,weight:-110}];var c=Ext.create("Ext.Viewport",{layout:{type:"border",padding:0},defaults:{split:true},items:[{region:"north",cls:"app-header",height:60,minHeight:60,maxHeight:60,html:'<div class="totem-logo-small"></div>Plateforme Totem'},accordionPanel,centerPanel,propertyPanel,bottomPanel]})})});